module.exports=[54799,(e,t,r)=>{t.exports=e.x("crypto",()=>require("crypto"))},63021,(e,t,r)=>{t.exports=e.x("@prisma/client-2c3a283f134fdcb6",()=>require("@prisma/client-2c3a283f134fdcb6"))},78787,e=>{"use strict";var t=e.i(63021);let r=e.g.prisma||new t.PrismaClient({log:["error"]});e.s(["prisma",0,r])},93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},70406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},20635,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},14180,e=>{"use strict";var t=e.i(89171),r=e.i(54799);function a(e){if(!e?.headers?.get)return r.default.randomUUID();let t=e.headers.get("x-request-id")?.trim();return t&&t.length>0?t:r.default.randomUUID()}function i(e,r){let a=t.NextResponse.json(e,{status:r.status??200});return a.headers.set("x-request-id",r.requestId),a}e.s(["getOrCreateRequestId",()=>a,"jsonWithRequestId",()=>i])},75225,e=>{"use strict";let t={info:0,warn:1,error:2},r="error"===process.env.LOG_LEVEL?"error":"info";function a(e,a,i,n){if(!(t[e]>=t[r]))return;let s=JSON.stringify({level:e,message:a,timestamp:new Date().toISOString(),...n&&{requestId:n},...i});"error"===e?process.stderr.write(s+"\n"):process.stdout.write(s+"\n")}function i(e){let t=e.headers.get("x-request-id");if(t&&"string"==typeof t)return t}e.s(["getRequestId",()=>i,"logger",0,{info(e,t,r){a("info",e,t,r)},warn(e,t,r){a("warn",e,t,r)},error(e,t,r){a("error",e,t,r)}}])},22734,(e,t,r)=>{t.exports=e.x("fs",()=>require("fs"))},46786,(e,t,r)=>{t.exports=e.x("os",()=>require("os"))},79594,(e,t,r)=>{t.exports=e.x("dns",()=>require("dns"))},4446,(e,t,r)=>{t.exports=e.x("net",()=>require("net"))},55004,(e,t,r)=>{t.exports=e.x("tls",()=>require("tls"))},14747,(e,t,r)=>{t.exports=e.x("path",()=>require("path"))},88947,(e,t,r)=>{t.exports=e.x("stream",()=>require("stream"))},27699,(e,t,r)=>{t.exports=e.x("events",()=>require("events"))},24361,(e,t,r)=>{t.exports=e.x("util",()=>require("util"))},92509,(e,t,r)=>{t.exports=e.x("url",()=>require("url"))},8625,e=>{"use strict";var t=e.i(42512),r=e.i(75225);let a=null;async function i(e,i,n){try{let s=function(){if(a)return a;let e=process.env.REDIS_URL||"redis://localhost:6379";try{return(a=new t.default(e,{maxRetriesPerRequest:1,retryStrategy:e=>e>2?null:Math.min(200*e,1e3),lazyConnect:!0})).on("error",()=>{a=null}),a}catch{return null}}();if(!s)return r.logger.warn("Redis down, bypassing rate limit",{identifier:e}),{success:!0,remaining:i,reset:0};await s.connect().catch(()=>{});let o=`ratelimit:${e}`,u=await s.get(o),d=u?parseInt(u):0;if(d>=i){let e=await s.ttl(o);return{success:!1,remaining:0,reset:Date.now()+(e>0?1e3*e:1e3*n)}}let l=s.multi();return l.incr(o),u||l.expire(o,n),await l.exec(),{success:!0,remaining:i-(d+1),reset:Date.now()+1e3*n}}catch(e){return r.logger.error("Rate limit error",{error:e instanceof Error?e.message:"Unknown"}),{success:!0,remaining:i,reset:0}}}e.s(["rateLimit",()=>i])},69422,76054,e=>{"use strict";e.i(84143);var t=e.i(68162);e.i(17059);var r=e.i(77842);e.i(21564);var a=e.i(71998),i=e.i(87040),n=e.i(84680),s=e.i(78787),o=e.i(75225);async function u(e,t,r,s){try{let o=await (0,i.getWebContextForRole)("viability",[`${e} mercado tend\xeancias`],r&&s?{workspaceId:r,userId:s}:void 0),u=t.segments.slice(0,10).map(e=>`${e.type}: ${e.count} (avg ${e.avgRating??"n/a"}★)`).join("; "),d=`Voc\xea \xe9 um analista de intelig\xeancia de mercado especializado em mercados locais brasileiros.
Com base nos DADOS REAIS coletados via Google Maps abaixo, gere insights executivos do mercado.

DADOS DO MERCADO:
- Busca: "${e}"
- Total de neg\xf3cios mapeados: ${t.totalBusinesses}
- Rating m\xe9dio: ${t.avgRating??"N/A"}
- Segmentos: ${u||"N/A"}
- % com website: ${t.withWebsitePercent}%
- % com telefone: ${t.withPhonePercent}%
- \xcdndice de satura\xe7\xe3o: ${t.saturationIndex}

Responda EXCLUSIVAMENTE em JSON v\xe1lido, sem markdown, sem backticks:
{
  "executiveSummary": "<par\xe1grafo de 3-4 frases com vis\xe3o geral executiva do mercado, mencione n\xfameros>",
  "marketTrends": ["<tend\xeancia 1>", "<tend\xeancia 2>", "<tend\xeancia 3>"],
  "opportunities": ["<oportunidade de neg\xf3cio 1>", "<oportunidade 2>", "<oportunidade 3>"],
  "recommendations": ["<recomenda\xe7\xe3o estrat\xe9gica 1>", "<recomenda\xe7\xe3o 2>", "<recomenda\xe7\xe3o 3>", "<recomenda\xe7\xe3o 4>"]
}

REGRAS:
- Baseie-se nos dados fornecidos, n\xe3o invente n\xfameros
- executiveSummary: tom executivo, com dados concretos
- marketTrends: tend\xeancias observ\xe1veis a partir dos dados
- opportunities: oportunidades reais para quem vende servi\xe7os digitais
- recommendations: a\xe7\xf5es estrat\xe9gicas pr\xe1ticas
${o?`

${o}

`:""}`,{config:l}=await (0,a.resolveAiForRole)("viability"),c=await (0,a.generateCompletionForRole)("viability",{prompt:d,jsonMode:!0,maxTokens:2500});c.usage&&r&&s&&(0,n.recordUsageEvent)({workspaceId:r,userId:s,type:"AI_TOKENS",quantity:1,metadata:{provider:l.provider,model:l.model,inputTokens:c.usage.inputTokens,outputTokens:c.usage.outputTokens}});let p=c.text.replace(/```json\s*/gi,"").replace(/```\s*/gi,"").trim();return JSON.parse(p)}catch(e){return o.logger.error("Market AI insights generation failed",{error:e instanceof Error?e.message:"Unknown"}),null}}async function d(e,a){let i,n=Math.min(e.pageSize??60,t.SEARCH_ALL_PAGES_MAX_PLACES),d={textQuery:e.textQuery,includedType:e.includedType,city:e.city,state:e.state},l=(await (0,t.runSearchAllPages)(d,a,n)).places??[],c=l.length,p=new Map,m=0,x=0;for(let e of l){let t=function(e){let t=e.primaryType,r=e.types;return t||(r?.length?r[0]:"establishment")}(e),r=p.get(t)??{count:0,sumRating:0,countRating:0};r.count+=1;let a=e.rating;null!=a&&a>0&&(r.sumRating+=a,r.countRating+=1),p.set(t,r),(e.websiteUri??e.website)?.toString()?.trim()&&(m+=1),(e.nationalPhoneNumber??e.phone)?.toString()?.trim()&&(x+=1)}let g=Array.from(p.entries()).map(([e,t])=>({type:e,count:t.count,avgRating:t.countRating>0?Math.round(t.sumRating/t.countRating*10)/10:null})).sort((e,t)=>t.count-e.count),y=g.length,w=y>0?Math.round(c/y):0,v=c>0?Math.round(m/c*100):0,f=c>0?Math.round(x/c*100):0,h=l.map(e=>({id:e.id,displayName:e.displayName,formattedAddress:e.formattedAddress,websiteUri:e.websiteUri??e.website,nationalPhoneNumber:e.nationalPhoneNumber??e.phone,rating:e.rating,userRatingCount:e.userRatingCount??e.reviewCount,primaryType:e.primaryType,types:e.types,businessStatus:e.businessStatus})),{scored:b,avgRating:R}=(0,r.scoreAndRankPlaces)(h,15),k=await s.prisma.user.findFirst({where:{id:a},include:{workspaces:{include:{workspace:!0},take:1}}});k?.workspaces?.length&&(i=k.workspaces[0].workspace.id);let S=await u(e.textQuery,{totalBusinesses:c,segments:g,withWebsitePercent:v,withPhonePercent:f,saturationIndex:w,avgRating:R},i,a),A={totalBusinesses:c,segments:g,digitalMaturity:{withWebsite:m,withPhone:x,total:c,withWebsitePercent:v,withPhonePercent:f},saturationIndex:w,avgRating:R,topOpportunities:b,aiInsights:S};return i&&s.prisma.intelligenceReport.create({data:{workspaceId:i,userId:a,module:"MARKET",inputQuery:e.textQuery,inputCity:e.city,inputState:e.state,resultsData:JSON.parse(JSON.stringify(A))}}).catch(e=>o.logger.error("Failed to persist market report",{error:e instanceof Error?e.message:"Unknown"})),A}e.s(["runMarketReport",()=>d],76054),e.s([],69422)},95744,14578,e=>{"use strict";e.i(84143);var t=e.i(68162);e.i(17059);var r=e.i(77842);e.i(21564);var a=e.i(71998),i=e.i(87040),n=e.i(84680),s=e.i(78787),o=e.i(75225);async function u(e,t,r,s){try{let o=await (0,i.getWebContextForRole)("viability",[`${e.textQuery} concorr\xeancia mercado`],r&&s?{workspaceId:r,userId:s}:void 0),u=`Voc\xea \xe9 um consultor de marketing digital e vendas B2B especializado em an\xe1lise competitiva local.
Com base nos DADOS REAIS de mercado abaixo, gere um playbook de ataque para quem quer vender servi\xe7os digitais (site, SEO, marketing) para esse nicho/regi\xe3o.

DADOS DO MERCADO LOCAL:
- Busca: "${e.textQuery}"
- Total de concorrentes mapeados: ${t.totalCount}
- Rating m\xe9dio: ${t.avgRating??"N/A"}
- Mediana de reviews (top 10): ${t.medianReviews}
- Com website: ${t.withWebsite} / Sem website: ${t.withoutWebsite}
- Top 3 por rating: ${t.topByRating||"N/A"}
- Top 3 por reviews: ${t.topByReviews||"N/A"}
- Oportunidades (presen\xe7a digital fraca): ${t.opportunitiesCount}

Responda EXCLUSIVAMENTE em JSON v\xe1lido, sem markdown, sem backticks:
{
  "entryBarrier": "<alto | medio | baixo>",
  "entryBarrierExplanation": "<1-2 frases explicando por que a barreira \xe9 esse n\xedvel>",
  "marketSummary": "<par\xe1grafo de 2-3 frases descrevendo o panorama competitivo>",
  "seoChecklist": ["<a\xe7\xe3o SEO 1>", "<a\xe7\xe3o SEO 2>", "<a\xe7\xe3o SEO 3>", "<a\xe7\xe3o SEO 4>", "<a\xe7\xe3o SEO 5>"],
  "reviewStrategy": ["<estrat\xe9gia 1>", "<estrat\xe9gia 2>", "<estrat\xe9gia 3>"],
  "quickWins": ["<a\xe7\xe3o r\xe1pida 24-72h #1>", "<a\xe7\xe3o r\xe1pida #2>", "<a\xe7\xe3o r\xe1pida #3>", "<a\xe7\xe3o r\xe1pida #4>"]
}

REGRAS:
- Baseie-se nos dados fornecidos
- seoChecklist: a\xe7\xf5es pr\xe1ticas de SEO Local (Google Meu Neg\xf3cio, NAP, schema, p\xe1ginas)
- reviewStrategy: como conseguir mais reviews que os concorrentes
- quickWins: a\xe7\xf5es que d\xe3o resultado em 24-72 horas
- entryBarrier alto = top players muito fortes, muitas reviews, mercado saturado
- entryBarrier baixo = poucos concorrentes bons, muitos sem site, f\xe1cil se destacar
${o?`

${o}

`:""}`,{config:d}=await (0,a.resolveAiForRole)("viability"),l=await (0,a.generateCompletionForRole)("viability",{prompt:u,jsonMode:!0,maxTokens:3e3});l.usage&&r&&s&&(0,n.recordUsageEvent)({workspaceId:r,userId:s,type:"AI_TOKENS",quantity:1,metadata:{provider:d.provider,model:d.model,inputTokens:l.usage.inputTokens,outputTokens:l.usage.outputTokens}});let c=l.text.replace(/```json\s*/gi,"").replace(/```\s*/gi,"").trim();return JSON.parse(c)}catch(e){return o.logger.error("Competitor AI playbook generation failed",{error:e instanceof Error?e.message:"Unknown"}),null}}async function d(e,a){let i,n=Math.min(e.pageSize??60,t.SEARCH_ALL_PAGES_MAX_PLACES),d=((await (0,t.runSearchAllPages)({...e},a,n)).places??[]).map(e=>{let t;return t=e.displayName,{id:String(e.id??""),name:t?.text??"",formattedAddress:e.formattedAddress,websiteUri:e.websiteUri??e.website,nationalPhoneNumber:e.nationalPhoneNumber??e.phone,rating:e.rating,userRatingCount:e.userRatingCount??e.reviewCount,primaryType:e.primaryType}}).filter(e=>e.id&&e.name),l=d.filter(e=>!!e.websiteUri?.trim()).length,c=d.filter(e=>!!e.nationalPhoneNumber?.trim()).length,p=[...d].filter(e=>null!=e.rating&&e.rating>0).sort((e,t)=>(t.rating??0)-(e.rating??0)).slice(0,10).map((e,t)=>({position:t+1,id:e.id,name:e.name,rating:e.rating,reviewCount:e.userRatingCount})),m=[...d].filter(e=>(e.userRatingCount??0)>0).sort((e,t)=>(t.userRatingCount??0)-(e.userRatingCount??0)).slice(0,10).map((e,t)=>({position:t+1,id:e.id,name:e.name,reviewCount:e.userRatingCount??0,rating:e.rating})),x=d.filter(e=>!e.websiteUri?.trim()||!e.nationalPhoneNumber?.trim()).map(e=>({id:e.id,name:e.name,missingWebsite:!e.websiteUri?.trim(),missingPhone:!e.nationalPhoneNumber?.trim()})),g=d.map(e=>({id:e.id,name:e.name,formattedAddress:e.formattedAddress,websiteUri:e.websiteUri,nationalPhoneNumber:e.nationalPhoneNumber,rating:e.rating,userRatingCount:e.userRatingCount,primaryType:e.primaryType})),{scored:y,medianReviews:w,avgRating:v}=(0,r.scoreAndRankPlaces)(g,20),f=await s.prisma.user.findFirst({where:{id:a},include:{workspaces:{include:{workspace:!0},take:1}}});f?.workspaces?.length&&(i=f.workspaces[0].workspace.id);let h=await u(e,{totalCount:d.length,avgRating:v,medianReviews:w,withWebsite:l,withoutWebsite:d.length-l,topByRating:p.slice(0,3).map(e=>`${e.name} (${e.rating}★)`).join(", "),topByReviews:m.slice(0,3).map(e=>`${e.name} (${e.reviewCount} avalia\xe7\xf5es)`).join(", "),opportunitiesCount:x.length},i,a),b={totalCount:d.length,rankingByRating:p,rankingByReviews:m,digitalPresence:{withWebsite:l,withoutWebsite:d.length-l,withPhone:c,withoutPhone:d.length-c},opportunities:x,avgRating:v,medianReviews:w,topOpportunities:y,aiPlaybook:h};return i&&s.prisma.intelligenceReport.create({data:{workspaceId:i,userId:a,module:"COMPETITORS",inputQuery:e.textQuery,inputCity:e.city,inputState:e.state,resultsData:JSON.parse(JSON.stringify(b))}}).catch(e=>o.logger.error("Failed to persist competitor report",{error:e instanceof Error?e.message:"Unknown"})),b}e.s(["runCompetitorAnalysis",()=>d],14578),e.s([],95744)},10906,e=>{e.v(e=>Promise.resolve().then(()=>e(78787)))},99913,e=>{e.v(t=>Promise.all(["server/chunks/backend_src_lib_ai_encrypt_ts_ff8430df._.js"].map(t=>e.l(t))).then(()=>t(85981)))},82269,e=>{e.v(e=>Promise.resolve().then(()=>e(84680)))},31443,e=>{e.v(e=>Promise.resolve().then(()=>e(75225)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__4674c9e4._.js.map