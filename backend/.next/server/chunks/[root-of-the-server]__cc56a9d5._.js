module.exports=[54799,(e,a,t)=>{a.exports=e.x("crypto",()=>require("crypto"))},63021,(e,a,t)=>{a.exports=e.x("@prisma/client-2c3a283f134fdcb6",()=>require("@prisma/client-2c3a283f134fdcb6"))},78787,e=>{"use strict";var a=e.i(63021);let t=e.g.prisma||new a.PrismaClient({log:["error"]});e.s(["prisma",0,t])},93695,(e,a,t)=>{a.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},32319,(e,a,t)=>{a.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,a,t)=>{a.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},18622,(e,a,t)=>{a.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,a,t)=>{a.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},70406,(e,a,t)=>{a.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},20635,(e,a,t)=>{a.exports=e.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},48419,e=>{"use strict";var a=e.i(69719);let t=a.z.object({email:a.z.string().email("Invalid email").transform(e=>e.trim().toLowerCase()),password:a.z.string().min(8,"Password must be at least 8 characters"),name:a.z.string().max(200).optional().transform(e=>e?.trim()||void 0)}),r=a.z.object({companyName:a.z.string().max(500).optional().transform(e=>e?.trim()||void 0),productService:a.z.string().max(500).optional().transform(e=>e?.trim()||void 0),targetAudience:a.z.string().max(500).optional().transform(e=>e?.trim()||void 0),mainBenefit:a.z.string().max(500).optional().transform(e=>e?.trim()||void 0)}),i=a.z.object({textQuery:a.z.string().min(1,"textQuery is required").max(500),includedType:a.z.string().max(100).optional(),pageSize:a.z.coerce.number().int().min(1).max(100).optional(),pageToken:a.z.string().optional(),hasWebsite:a.z.enum(["yes","no"]).optional(),hasPhone:a.z.enum(["yes","no"]).optional(),city:a.z.string().max(200).optional(),state:a.z.string().max(100).optional(),country:a.z.string().max(100).optional(),radiusKm:a.z.coerce.number().min(1).max(100).optional()}),o=a.z.object({textQuery:a.z.string().min(1,"textQuery is required").max(500),includedType:a.z.string().max(100).optional(),pageSize:a.z.coerce.number().int().min(1).max(60).optional(),city:a.z.string().max(200).optional(),state:a.z.string().max(100).optional()}),s=a.z.object({placeId:a.z.string().min(1,"placeId is required"),name:a.z.string().min(1,"Business name is required"),userProfile:a.z.record(a.z.string(),a.z.unknown()).optional(),locale:a.z.string().optional(),websiteUri:a.z.string().optional(),website:a.z.string().optional(),formattedAddress:a.z.string().optional(),address:a.z.string().optional(),nationalPhoneNumber:a.z.string().optional(),internationalPhoneNumber:a.z.string().optional(),phone:a.z.string().optional(),rating:a.z.number().optional(),userRatingCount:a.z.number().optional(),reviewCount:a.z.number().optional(),types:a.z.array(a.z.string()).optional(),primaryType:a.z.string().optional(),businessStatus:a.z.string().optional(),reviews:a.z.array(a.z.object({rating:a.z.number(),text:a.z.object({text:a.z.string()}).optional(),authorAttribution:a.z.object({displayName:a.z.string()}).optional(),relativePublishTimeDescription:a.z.string().optional()})).optional()}),n=a.z.object({name:a.z.string().max(200).optional().transform(e=>e?.trim()||void 0),phone:a.z.string().max(50).optional().transform(e=>e?.trim()||void 0),address:a.z.string().max(500).optional().transform(e=>e?.trim()||void 0),linkedInUrl:a.z.string().max(500).optional().transform(e=>e?.trim()||void 0),instagramUrl:a.z.string().max(500).optional().transform(e=>e?.trim()||void 0),facebookUrl:a.z.string().max(500).optional().transform(e=>e?.trim()||void 0),websiteUrl:a.z.string().max(500).optional().transform(e=>e?.trim()||void 0),image:a.z.string().max(2e3).optional().transform(e=>e?.trim()||void 0),notifyByEmail:a.z.boolean().optional(),notifyWeeklyReport:a.z.boolean().optional(),notifyLeadAlerts:a.z.boolean().optional()}),l=a.z.object({useProfile:a.z.boolean().optional().default(!0),companyName:a.z.string().max(500).optional().transform(e=>e?.trim()||void 0),city:a.z.string().max(200).optional().transform(e=>e?.trim()||void 0),state:a.z.string().max(100).optional().transform(e=>e?.trim()||void 0),productService:a.z.string().max(500).optional().transform(e=>e?.trim()||void 0),targetAudience:a.z.string().max(500).optional().transform(e=>e?.trim()||void 0),mainBenefit:a.z.string().max(500).optional().transform(e=>e?.trim()||void 0),address:a.z.string().max(500).optional().transform(e=>e?.trim()||void 0),websiteUrl:a.z.string().max(500).optional().transform(e=>e?.trim()||void 0),linkedInUrl:a.z.string().max(500).optional().transform(e=>e?.trim()||void 0),instagramUrl:a.z.string().max(500).optional().transform(e=>e?.trim()||void 0),facebookUrl:a.z.string().max(500).optional().transform(e=>e?.trim()||void 0)}),c=a.z.object({companyName:a.z.string().max(500).optional().transform(e=>e?.trim()||void 0),productService:a.z.string().max(500).optional().transform(e=>e?.trim()||void 0),targetAudience:a.z.string().max(500).optional().transform(e=>e?.trim()||void 0),mainBenefit:a.z.string().max(500).optional().transform(e=>e?.trim()||void 0),address:a.z.string().max(500).optional().transform(e=>e?.trim()||void 0),linkedInUrl:a.z.string().max(500).optional().transform(e=>e?.trim()||void 0),instagramUrl:a.z.string().max(500).optional().transform(e=>e?.trim()||void 0),facebookUrl:a.z.string().max(500).optional().transform(e=>e?.trim()||void 0),websiteUrl:a.z.string().max(500).optional().transform(e=>e?.trim()||void 0),logoUrl:a.z.string().max(2e3).optional().transform(e=>e?.trim()||void 0)}),d=a.z.object({planId:a.z.string().min(1,"planId is required"),locale:a.z.string().max(10).optional(),cycle:a.z.enum(["monthly","annual"]).optional(),interval:a.z.enum(["monthly","annual"]).optional(),card_token_id:a.z.string().max(500).optional(),scheduleAtPeriodEnd:a.z.boolean().optional()}),p=a.z.object({planId:a.z.enum(["FREE","BASIC","PRO","BUSINESS","SCALE"],{message:"planId must be a valid plan key"})}),u=a.z.object({token:a.z.string().min(1,"token is required"),issuer_id:a.z.string().optional(),payment_method_id:a.z.string().min(1,"payment_method_id is required"),transaction_amount:a.z.coerce.number().positive("transaction_amount must be positive"),installments:a.z.number().int().min(1).optional(),payer:a.z.object({email:a.z.string().email().optional(),identification:a.z.object({type:a.z.string().optional(),number:a.z.string().optional()}).optional()}).optional(),planId:a.z.string().min(1,"planId is required"),interval:a.z.enum(["monthly","annual"])}),m=a.z.object({limit:a.z.coerce.number().int().min(1).max(100).optional(),offset:a.z.coerce.number().int().min(0).optional(),workspaceId:a.z.string().min(1).optional()}),g=a.z.object({limit:a.z.coerce.number().int().min(1).max(100).optional(),offset:a.z.coerce.number().int().min(0).optional(),search:a.z.string().min(1).max(200).optional()}),f=a.z.object({reason:a.z.string().max(500).optional()}),h=a.z.object({sendEmail:a.z.boolean().optional(),temporaryPassword:a.z.string().min(8,"Password must be at least 8 characters").optional()}).refine(e=>!0===e.sendEmail||null!=e.temporaryPassword&&e.temporaryPassword.length>=8,{message:"Either sendEmail true or temporaryPassword (min 8 chars) is required"}),v=a.z.object({plan:a.z.enum(["FREE","BASIC","PRO","BUSINESS","SCALE"]).optional(),leadsLimit:a.z.coerce.number().int().min(0).optional()}),y=a.z.object({email:a.z.string().email("Valid email is required").transform(e=>e.trim().toLowerCase())}),A=a.z.object({email:a.z.string().min(1,"Email is required").email("Invalid email address")}),b=a.z.object({token:a.z.string().min(1,"Token and password are required"),password:a.z.string().min(8,"Password must be at least 8 characters")}),x=a.z.object({code:a.z.string().length(6,"Code must be 6 digits").regex(/^\d{6}$/,"Code must be 6 digits")}),E=a.z.object({placeId:a.z.string().min(1,"placeId is required")}),w=a.z.object({format:a.z.enum(["json","csv"]).optional()}),S=a.z.object({limit:a.z.coerce.number().int().min(1).max(100).optional(),offset:a.z.coerce.number().int().min(0).optional()}),I=a.z.object({status:a.z.enum(["NEW","CONTACTED","CONVERTED","LOST"]).optional(),isFavorite:a.z.boolean().optional()}).refine(e=>void 0!==e.status||void 0!==e.isFavorite,{message:"At least one of status or isFavorite is required"}),R=a.z.object({userIdToRemove:a.z.string().min(1,"User ID to remove is required")}),z=s.extend({userId:a.z.string().optional()}),N=a.z.object({role:a.z.enum(["lead_analysis","viability"]),provider:a.z.enum(["GEMINI","OPENAI","CLOUDFLARE"]),model:a.z.string().min(1).max(200),apiKey:a.z.string().optional(),cloudflareAccountId:a.z.string().max(100).optional(),enabled:a.z.boolean().optional().default(!0)}),C=a.z.object({role:a.z.enum(["lead_analysis","viability"]).optional(),provider:a.z.enum(["GEMINI","OPENAI","CLOUDFLARE"]).optional(),model:a.z.string().min(1).max(200).optional(),apiKey:a.z.string().optional(),cloudflareAccountId:a.z.string().max(100).optional().nullable(),enabled:a.z.boolean().optional()}),k=a.z.object({role:a.z.enum(["lead_analysis","viability"]),provider:a.z.enum(["SERPER","TAVILY"]),apiKey:a.z.string().optional(),maxResults:a.z.number().int().min(1).max(20).optional().default(5),enabled:a.z.boolean().optional().default(!0)});function T(e){let a=e.error.issues[0];return a?`${a.path.join(".")||"body"}: ${a.message}`:"Validation failed"}e.s(["adminListQuerySchema",0,m,"adminResetPasswordSchema",0,h,"adminWorkspaceUpdateSchema",0,v,"aiConfigCreateSchema",0,N,"aiConfigUpdateSchema",0,C,"analyzeSchema",0,s,"checkoutSchema",0,d,"companyAnalysisSchema",0,l,"detailsQuerySchema",0,E,"exportLeadsQuerySchema",0,w,"forgotSchema",0,A,"formatZodError",()=>T,"leadStatusSchema",0,I,"marketReportSchema",0,o,"onboardingCompleteSchema",0,r,"processPaymentSchema",0,u,"profileSchema",0,n,"registerSchema",0,t,"resetSchema",0,b,"scheduleDowngradeSchema",0,p,"searchHistoryQuerySchema",0,S,"searchSchema",0,i,"supportDeactivateSchema",0,f,"supportUsersListSchema",0,g,"teamInviteSchema",0,y,"teamRemoveSchema",0,R,"twoFaCodeSchema",0,x,"v1AnalyzeSchema",0,z,"webSearchConfigSchema",0,k,"workspaceProfileSchema",0,c])},14180,e=>{"use strict";var a=e.i(89171),t=e.i(54799);function r(e){if(!e?.headers?.get)return t.default.randomUUID();let a=e.headers.get("x-request-id")?.trim();return a&&a.length>0?a:t.default.randomUUID()}function i(e,t){let r=a.NextResponse.json(e,{status:t.status??200});return r.headers.set("x-request-id",t.requestId),r}e.s(["getOrCreateRequestId",()=>r,"jsonWithRequestId",()=>i])},75225,e=>{"use strict";let a={info:0,warn:1,error:2},t="error"===process.env.LOG_LEVEL?"error":"info";function r(e,r,i,o){if(!(a[e]>=a[t]))return;let s=JSON.stringify({level:e,message:r,timestamp:new Date().toISOString(),...o&&{requestId:o},...i});"error"===e?process.stderr.write(s+"\n"):process.stdout.write(s+"\n")}function i(e){let a=e.headers.get("x-request-id");if(a&&"string"==typeof a)return a}e.s(["getRequestId",()=>i,"logger",0,{info(e,a,t){r("info",e,a,t)},warn(e,a,t){r("warn",e,a,t)},error(e,a,t){r("error",e,a,t)}}])},22734,(e,a,t)=>{a.exports=e.x("fs",()=>require("fs"))},46786,(e,a,t)=>{a.exports=e.x("os",()=>require("os"))},79594,(e,a,t)=>{a.exports=e.x("dns",()=>require("dns"))},4446,(e,a,t)=>{a.exports=e.x("net",()=>require("net"))},55004,(e,a,t)=>{a.exports=e.x("tls",()=>require("tls"))},14747,(e,a,t)=>{a.exports=e.x("path",()=>require("path"))},88947,(e,a,t)=>{a.exports=e.x("stream",()=>require("stream"))},27699,(e,a,t)=>{a.exports=e.x("events",()=>require("events"))},24361,(e,a,t)=>{a.exports=e.x("util",()=>require("util"))},92509,(e,a,t)=>{a.exports=e.x("url",()=>require("url"))},8625,e=>{"use strict";var a=e.i(42512),t=e.i(75225);let r=null;async function i(e,i,o){try{let s=function(){if(r)return r;let e=process.env.REDIS_URL||"redis://localhost:6379";try{return(r=new a.default(e,{maxRetriesPerRequest:1,retryStrategy:e=>e>2?null:Math.min(200*e,1e3),lazyConnect:!0})).on("error",()=>{r=null}),r}catch{return null}}();if(!s)return t.logger.warn("Redis down, bypassing rate limit",{identifier:e}),{success:!0,remaining:i,reset:0};await s.connect().catch(()=>{});let n=`ratelimit:${e}`,l=await s.get(n),c=l?parseInt(l):0;if(c>=i){let e=await s.ttl(n);return{success:!1,remaining:0,reset:Date.now()+(e>0?1e3*e:1e3*o)}}let d=s.multi();return d.incr(n),l||d.expire(n,o),await d.exec(),{success:!0,remaining:i-(c+1),reset:Date.now()+1e3*o}}catch(e){return t.logger.error("Rate limit error",{error:e instanceof Error?e.message:"Unknown"}),{success:!0,remaining:i,reset:0}}}e.s(["rateLimit",()=>i])},84680,e=>{"use strict";var a=e.i(78787);function t(t){let{workspaceId:r,userId:i,type:o,quantity:s=1,metadata:n}=t;a.prisma.usageEvent.create({data:{workspaceId:r,userId:i??void 0,type:o,quantity:s,metadata:n||void 0}}).catch(a=>{e.A(31443).then(({logger:e})=>e.warn("Usage event record failed",{workspaceId:r,type:o,error:a instanceof Error?a.message:"Unknown"}))})}async function r(e){if(0===e.length)return new Map;let t={googlePlacesSearch:0,googlePlacesDetails:0,serperRequests:0,aiInputTokens:0,aiOutputTokens:0},r=new Map(e.map(e=>[e,{...t}]));for(let t of(await a.prisma.usageEvent.groupBy({by:["workspaceId","type"],where:{workspaceId:{in:e},type:{not:"AI_TOKENS"}},_sum:{quantity:!0}}))){let e=r.get(t.workspaceId),a=t._sum.quantity??0;"GOOGLE_PLACES_SEARCH"===t.type?e.googlePlacesSearch=a:"GOOGLE_PLACES_DETAILS"===t.type?e.googlePlacesDetails=a:"SERPER_REQUEST"===t.type&&(e.serperRequests=a)}for(let t of(await a.prisma.usageEvent.findMany({where:{workspaceId:{in:e},type:"AI_TOKENS"},select:{workspaceId:!0,metadata:!0}}))){let e=r.get(t.workspaceId),a=t.metadata;a&&(e.aiInputTokens+=Number(a.inputTokens)||0,e.aiOutputTokens+=Number(a.outputTokens)||0)}return r}e.s(["getWorkspaceUsage",()=>r,"recordUsageEvent",()=>t])},21564,71998,e=>{"use strict";var a=e.i(99612),t=e.i(71586),r=e.i(12321);let i={lead_analysis:"gemini-flash-latest",viability:"gemini-2.5-flash",company_analysis:"gemini-2.5-flash"};async function o(e){let o=await l(e);if(o||"viability"!==e&&"company_analysis"!==e||(o=await l("company_analysis"===e?"viability":"lead_analysis")),o){let e=function(e,i,o,s){switch(e){case"GEMINI":return(0,a.createGeminiAdapter)(o,i);case"OPENAI":return(0,t.createOpenAIAdapter)(o,i);case"CLOUDFLARE":return(0,r.createCloudflareAdapter)(o,i,s);default:throw Error(`Unknown AI provider: ${e}`)}}(o.provider,o.model,o.apiKey,o.accountId);return{config:{provider:o.provider,model:o.model,apiKey:o.apiKey},adapter:e}}let s=process.env.GEMINI_API_KEY;if(!s)throw Error(`No AI config for role "${e}" and GEMINI_API_KEY not set`);let n=i[e],c=(0,a.createGeminiAdapter)(s,n);return{config:{provider:"GEMINI",model:n,apiKey:s},adapter:c}}async function s(e,a){let{adapter:t}=await o(e);return t.generateCompletion(a)}let n={lead_analysis:"LEAD_ANALYSIS",viability:"VIABILITY",company_analysis:"COMPANY_ANALYSIS"};async function l(a){try{let{prisma:t}=await e.A(10906),{decryptApiKey:r}=await e.A(99913),i=n[a],o=await t.aiProviderConfig.findFirst({where:{role:i,enabled:!0},orderBy:{updatedAt:"desc"}});if(!o||!o.apiKeyEncrypted)return null;let s=r(o.apiKeyEncrypted);return{provider:o.provider,model:o.model,apiKey:s,accountId:o.cloudflareAccountId??void 0}}catch{return null}}e.s(["generateCompletionForRole",()=>s,"resolveAiForRole",()=>o],71998),e.s([],21564)},87040,e=>{"use strict";async function a(e,t,r=5){let i=await fetch("https://google.serper.dev/search",{method:"POST",headers:{"X-API-KEY":e,"Content-Type":"application/json"},body:JSON.stringify({q:t,num:r})});if(!i.ok){let e=await i.text();throw Error(`Serper API error ${i.status}: ${e}`)}return((await i.json()).organic??[]).slice(0,r).map(e=>({title:e.title??"",link:e.link??"",snippet:e.snippet}))}let t={lead_analysis:"LEAD_ANALYSIS",viability:"VIABILITY",company_analysis:"COMPANY_ANALYSIS"};async function r(a){try{let{prisma:r}=await e.A(10906),{decryptApiKey:i}=await e.A(99913),o=t[a],s=await r.webSearchConfig.findUnique({where:{role:o}});if(!s||!s.enabled||!s.apiKeyEncrypted)return null;let n=i(s.apiKeyEncrypted);return{provider:s.provider,apiKey:n,maxResults:s.maxResults??5}}catch{return null}}async function i(t,i,o){let s=await r(t);if(!s||0===i.length)return"";let n=[],l=0;for(let e of i.slice(0,"company_analysis"===t?6:5)){if(!e.trim())continue;let{label:t,emoji:r}=function(e){let a=e.toLowerCase();return a.includes("reclame aqui")?{label:"Reclame Aqui ‚Äî Reputa√ß√£o do Consumidor",emoji:"üî¥"}:a.includes("jusbrasil")?{label:"JusBrasil ‚Äî Processos Judiciais",emoji:"‚öñÔ∏è"}:a.includes("cnpj")?{label:"CNPJ ‚Äî Dados Empresariais",emoji:"üè¢"}:a.includes("instagram")?{label:"Redes sociais ‚Äî Instagram",emoji:"üì±"}:a.includes("facebook")?{label:"Redes sociais ‚Äî Facebook",emoji:"üì±"}:a.includes("linkedin")?{label:"Redes sociais ‚Äî LinkedIn",emoji:"üì±"}:a.includes("avalia√ß√µes google")||a.includes("google reviews")?{label:"Avalia√ß√µes Google",emoji:"‚≠ê"}:{label:`Busca Web ‚Äî "${e}"`,emoji:"üîç"}}(e),i={label:t,emoji:r,items:[]};try{if("SERPER"===s.provider){let t=await a(s.apiKey,e.trim(),Math.min(s.maxResults,5));for(let e of(l+=1,t))i.items.push({title:e.title,link:e.link,snippet:e.snippet??""})}}catch{}n.push(i)}if(o?.workspaceId&&l>0){let{recordUsageEvent:a}=await e.A(82269);a({workspaceId:o.workspaceId,userId:o.userId??void 0,type:"SERPER_REQUEST",quantity:l})}let c=function(e){let a=[];for(let t of e)if(0!==t.items.length){for(let e of(a.push(`### ${t.emoji} ${t.label}`),t.items))a.push(`- **${e.title}** ‚Äî [${e.link}](${e.link})`),e.snippet&&a.push(`  ${e.snippet}`);a.push("")}return a.join("\n")}(n);return c.trim()?`## üìä Contexto da Web (dados reais coletados ‚Äî use-os na an\xe1lise e cite as fontes)

${c}`:""}e.s(["getWebContextForRole",()=>i],87040)},59615,e=>{"use strict";e.i(21564);var a=e.i(71998),t=e.i(87040),r=e.i(78787);async function i(s,n,l="pt",c,d=!1,p){let u=n;if(!u&&c){let e=await r.prisma.user.findUnique({where:{id:c}});e&&e.companyName&&(u={companyName:e.companyName,productService:e.productService||"",targetAudience:e.targetAudience||"",mainBenefit:e.mainBenefit||""})}!u||u.companyName?.trim()||u.productService?.trim()||(u=void 0);let m="en"===l,g=s.formattedAddress||s.address||"",f=g?g.split(",").pop()?.trim():"",h=[s.name,`Reclame Aqui ${s.name}`,`CNPJ ${s.name} ${f}`.trim(),`JusBrasil ${s.name}`,s.primaryType||s.types?.[0]||""].filter(Boolean),v=await (0,t.getWebContextForRole)("lead_analysis",h,p?{workspaceId:p.workspaceId,userId:p.userId}:void 0),y=s.nationalPhoneNumber||s.internationalPhoneNumber||s.phone||"",A=s.websiteUri||s.website||"",b=s.userRatingCount||s.reviewCount||0,x=s.reviews&&s.reviews.length>0?s.reviews.slice(0,5).map(e=>`[${e.rating}/5 - ${e.authorAttribution?.displayName||"Client"}]: "${e.text?.text?.slice(0,200)}"`).join("\n"):m?"No recent reviews available":"Nenhuma avalia√ß√£o recente dispon√≠vel",E=u?m?`You are a Senior B2B Commercial Consultant for "${u.companyName}".
"${u.companyName}" offers: "${u.productService}".
Target audience: "${u.targetAudience}".
Main competitive advantage: "${u.mainBenefit}".
CRUCIAL CONTEXT: Analyze the "website" gap through the lens of YOUR product ("${u.productService}"). If you sell websites/marketing, a missing website is a massive sales opportunity. If you sell Insurance, Cleaning, Logistics, Real Estate, or other physical/B2B services, a missing website is just a minor communication detail, NOT a critical flaw.
MANDATORY: The ENTIRE report (summary, strengths, weaknesses, gaps, painPoints, approachStrategy, suggestedScripts, fullReport) must be from the perspective of "${u.companyName}" selling ONLY "${u.productService}". Do NOT recommend or offer services that are not what this company sells (e.g. if they sell real estate, do NOT suggest offering websites, SEO, or digital marketing to the lead; suggest only real estate services such as finding space, listings, rentals).`:`Voc\xea \xe9 um Consultor Comercial B2B S\xeanior trabalhando para "${u.companyName}".
"${u.companyName}" oferece: "${u.productService}".
P\xfablico-alvo: "${u.targetAudience}".
Principal diferencial: "${u.mainBenefit}".
CONTEXTO CRUCIAL: Analise a lacuna de "website" atrav\xe9s da lente do SEU produto ("${u.productService}"). Se voc\xea vende sites/marketing, a falta de um site \xe9 uma enorme oportunidade de venda. Se voc\xea vende Seguros, Limpeza, Log\xedstica, Imobili\xe1ria ou outros servi\xe7os f\xedsicos/B2B, a falta de um site \xe9 apenas um detalhe de comunica\xe7\xe3o menor, N\xc3O uma falha cr\xedtica.
OBRIGAT\xd3RIO: O relat\xf3rio INTEIRO (resumo, pontos fortes, fraquezas, lacunas, dores, estrat\xe9gia de abordagem, scripts sugeridos, relat\xf3rio completo) deve ser na perspectiva de "${u.companyName}" vendendo APENAS "${u.productService}". N\xc3O recomende nem ofere\xe7a servi\xe7os que n\xe3o sejam o que esta empresa vende (ex.: se for imobili\xe1ria, N\xc3O sugira oferecer site, SEO ou marketing digital ao lead; sugira apenas servi\xe7os imobili\xe1rios como encontrar espa\xe7o, im\xf3veis para loca\xe7\xe3o/venda).`:m?"You are a Senior B2B Strategic Consultant specialized in commercial prospecting.":`Voc\xea \xe9 um Consultor Estrat\xe9gico B2B S\xeanior especializado em prospec\xe7\xe3o comercial.`,w=`${E}

${m?`Your task is to generate a DEEP, DETAILED, and ACTIONABLE strategic prospecting report for the lead below.
Be like a senior consultant who has researched this company thoroughly. Avoid generic statements.
Every insight must be specific to THIS business and how YOUR product/service can help them.`:`Sua tarefa \xe9 gerar um relat\xf3rio estrat\xe9gico de prospec\xe7\xe3o PROFUNDO, DETALHADO e ACION\xc1VEL para o lead abaixo.
Seja como um consultor s\xeanior que pesquisou a fundo esta empresa. Evite afirma\xe7\xf5es gen\xe9ricas.
Cada an\xe1lise deve ser espec\xedfica para ESTE neg\xf3cio e como o SEU produto/servi\xe7o pode ajud\xe1-los.`}

${m?"LEAD DATA:":"DADOS DO LEAD:"}
- ${m?"Business Name":"Nome do Neg√≥cio"}: ${s.name}
- ${m?"Type/Category":"Tipo/Categoria"}: ${s.primaryType||s.types?.join(", ")||(m?"Not specified":"N√£o especificado")}
- ${m?"Address":"Endere√ßo"}: ${g||(m?"Not available":"N√£o dispon√≠vel")}
- ${m?"Phone":"Telefone"}: ${y||(m?"No phone listed":"Sem telefone cadastrado")}
- Website: ${A||(m?"NO WEBSITE (critical gap)":"SEM WEBSITE (lacuna cr√≠tica)")}
- ${m?"Google Rating":"Avalia√ß√£o Google"}: ${s.rating??(m?"No rating":"Sem avalia√ß√£o")}/5
- ${m?"Total Reviews":"Total de Avalia√ß√µes"}: ${b}
- ${m?"Business Status":"Status do Neg√≥cio"}: ${s.businessStatus||"OPERATIONAL"}
${A?m?'\nCRITICAL: This lead HAS a website (URL above). You MUST acknowledge it, analyze it when relevant (content, UX, SEO, gaps in the site itself), and NEVER list "no website" or "missing website" as a gap.':'\nCR√çTICO: Este lead POSSUI website (URL acima). Voc√™ DEVE reconhec√™-lo, analis√°-lo quando relevante (conte√∫do, UX, SEO, lacunas no pr√≥prio site) e NUNCA listar "sem website" ou "aus√™ncia de site" como lacuna.':""}

${m?"RECENT CUSTOMER REVIEWS:":"AVALIA√á√ïES RECENTES DE CLIENTES:"}
${x}
${v?`

${v}
${d?m?"\nIMPORTANT: The web context above contains REAL data collected from Reclame Aqui, JusBrasil, CNPJ databases, and general web searches. You MUST analyze this data carefully and incorporate it into your report. Cite specific findings and sources. If Reclame Aqui shows complaints, detail them. If JusBrasil shows lawsuits, flag the risks. If CNPJ data reveals information about the company, use it.":"\nIMPORTANTE: O contexto da web acima cont√©m dados REAIS coletados do Reclame Aqui, JusBrasil, bases de CNPJ e buscas web gerais. Voc√™ DEVE analisar esses dados cuidadosamente e incorpor√°-los ao seu relat√≥rio. Cite achados e fontes espec√≠ficas. Se o Reclame Aqui mostra reclama√ß√µes, detalhe-as. Se o JusBrasil mostra processos, sinalize os riscos. Se dados de CNPJ revelam informa√ß√µes sobre a empresa, use-os.":""}

`:""}

${m?"ANALYSIS REQUIREMENTS (be extremely specific, not generic):":"REQUISITOS DA AN√ÅLISE (seja extremamente espec√≠fico, n√£o gen√©rico):"}

1. ${m?"DIGITAL PRESENCE GAPS: What is this business missing? (website, online booking, e-commerce, CRM, social media management, paid ads, SEO, etc.) Consider if missing a website is actually a problem for them based on what YOU sell.":"LACUNAS DE PRESEN√áA DIGITAL: O que este neg√≥cio est√° faltando? (website, agendamento online, e-commerce, CRM, gest√£o de redes sociais, an√∫ncios pagos, SEO, etc.) Considere se a falta de um site √© realmente um problema para eles com base no que VOC√ä vende."}

2. ${m?"CUSTOMER PAIN POINTS: Based on reviews and business type, what frustrations do their customers likely face? What operational challenges does this business have?":"DORES DO CLIENTE: Com base nas avalia√ß√µes e tipo de neg√≥cio, quais frustra√ß√µes os clientes provavelmente enfrentam? Quais desafios operacionais este neg√≥cio tem?"}

3. ${m?"SOCIAL MEDIA STRATEGY: Proactively analyze scenarios for Instagram, LinkedIn, and Facebook based on their niche. Suggest what kind of content they SHOULD be posting to get more clients. Be highly sincere about what they can improve.":"ESTRAT√âGIA DE REDES SOCIAIS: Analise proativamente cen√°rios para Instagram, LinkedIn e Facebook com base no nicho deles. Sugira que tipo de conte√∫do eles DEVERIAM postar para atrair mais clientes. Seja altamente sincero sobre o que eles podem melhorar."}

4. ${m?"FIRST CONTACT MESSAGE: Write a professional, personalized opening message for the FIRST contact (WhatsApp/email). It should reference something specific about this business (their rating, a review pattern, missing digital element). Max 3 short paragraphs. No generic templates.":"MENSAGEM DE PRIMEIRO CONTATO: Escreva uma mensagem de abertura profissional e personalizada para o PRIMEIRO contato (WhatsApp/email). Deve referenciar algo espec√≠fico deste neg√≥cio (avalia√ß√£o, padr√£o nas reviews, elemento digital faltando). M√°ximo 3 par√°grafos curtos. Sem templates gen√©ricos."}
5. ${m?'REVIEW RECENCY: Analyze the time of reviews. If reviews are mostly from years ago, flag this as a "stagnant reputation". If recent, analyze the trend.':'REC√äNCIA DE REVIEWS: Analise o tempo das avalia√ß√µes. Se forem majoritariamente de anos atr√°s, aponte isso como "reputa√ß√£o estagnada". Se recentes, analise a tend√™ncia.'}
${d?m?"6. DEEP REPUTATION ANALYSIS: Using the REAL data from Reclame Aqui and JusBrasil provided in the web context above, analyze: (a) consumer reputation ‚Äî complaints, response rate, resolution rate; (b) legal risks ‚Äî lawsuits, labor disputes, consumer protection cases; (c) CNPJ data ‚Äî company size, founding date, business activities. Include ALL findings in the full report with source citations.":"6. AN√ÅLISE PROFUNDA DE REPUTA√á√ÉO: Usando os dados REAIS do Reclame Aqui e JusBrasil fornecidos no contexto da web acima, analise: (a) reputa√ß√£o do consumidor ‚Äî reclama√ß√µes, taxa de resposta, taxa de resolu√ß√£o; (b) riscos legais ‚Äî processos, disputas trabalhistas, casos de defesa do consumidor; (c) dados de CNPJ ‚Äî porte da empresa, data de funda√ß√£o, atividades empresariais. Inclua TODOS os achados no relat√≥rio completo com cita√ß√µes de fonte.":""}
7. ${m?"WHATSAPP MESSAGE: A shorter, more casual version for WhatsApp (max 2 short paragraphs, conversational tone, gets to the point fast).":"MENSAGEM WHATSAPP: Uma vers√£o mais curta e casual para WhatsApp (m√°ximo 2 par√°grafos curtos, tom conversacional, vai direto ao ponto)."}

${m?"CRITICAL: Respond ONLY with valid JSON, no markdown, no code blocks. Values must be in ENGLISH:":"CR√çTICO: Responda APENAS com JSON v√°lido, sem markdown, sem blocos de c√≥digo. Valores devem estar em PORTUGU√äS:"}
{
  "score": <number 1-100>,
  "scoreLabel": "<${m?"Cold|Warm|Hot|Very Hot":"Frio|Morno|Quente|Muito Quente"}>",
  "summary": "<${m?"Provide a dense executive summary specific to this business, without strict length constraints.":"Forne√ßa um denso resumo executivo espec√≠fico para este neg√≥cio, sem limite estrito de tamanho."}>",
  "strengths": ["<${m?"specific strength 1":"for√ßa espec√≠fica 1"}>", "<${m?"strength 2":"for√ßa 2"}>", "<${m?"strength 3":"for√ßa 3"}>"],
  "weaknesses": ["<${m?"specific weakness 1":"fraqueza espec√≠fica 1"}>", "<${m?"weakness 2":"fraqueza 2"}>", "<${m?"weakness 3":"fraqueza 3"}>"],
  "painPoints": ["<${m?"specific customer pain point 1":"dor espec√≠fica do cliente 1"}>", "<${m?"pain point 2":"dor 2"}>", "<${m?"pain point 3":"dor 3"}>", "<${m?"operational challenge 4":"desafio operacional 4"}>"],
  "gaps": ["<${m?"digital gap 1: e.g. No website":"lacuna digital 1: ex. Sem website"}>", "<${m?"gap 2":"lacuna 2"}>", "<${m?"gap 3":"lacuna 3"}>", "<${m?"gap 4":"lacuna 4"}>"],
  "approach": "<${m?"Specific approach strategy: what angle to use, what pain to address first, timing recommendations":"Estrat√©gia de abordagem espec√≠fica: qual √¢ngulo usar, qual dor abordar primeiro, recomenda√ß√µes de timing"}>",
  "contactStrategy": "<${m?"Recommended channels (WhatsApp, LinkedIn, phone, email), best time to contact, who likely to answer, what to say first call":"Canais recomendados (WhatsApp, LinkedIn, telefone, email), melhor hor√°rio para contato, quem provavelmente atende, o que dizer na primeira liga√ß√£o"}>",
  "firstContactMessage": "<${m?"Professional personalized opening message for first contact (email/WhatsApp), max 3 short paragraphs, specific to this business":"Mensagem de abertura profissional e personalizada para primeiro contato (email/WhatsApp), m√°ximo 3 par√°grafos curtos, espec√≠fica para este neg√≥cio"}>",
  "suggestedWhatsAppMessage": "<${m?"Shorter casual WhatsApp version, 2 paragraphs max, conversational, direct":"Vers√£o mais curta e casual para WhatsApp, 2 par√°grafos no m√°ximo, conversacional, direta"}>",
  "reviewAnalysis": "<${m?"Detailed analysis of the rating trend and recency":"An√°lise detalhada da tend√™ncia e rec√™ncia das avalia√ß√µes"}>",
  "socialMedia": {
    "instagram": "<${m?"CRITICAL: ONLY return real URLs. NEVER invent or hallucinate. If unsure, return Not found":"CR√çTICO: Retorne APENAS URLs reais. NUNCA invente ou alucine. Se n√£o tiver certeza absoluta, retorne exatamente N√£o encontrado"}>",
    "facebook": "<${m?"CRITICAL: NEVER hallucinate URLs. If unsure, return Not found":"CR√çTICO: NUNCA alucine URLs. Se n√£o tiver certeza, retorne exatamente N√£o encontrado"}>",
    "linkedin": "<${m?"CRITICAL: NEVER hallucinate URLs. If unsure, return Not found":"CR√çTICO: NUNCA alucine URLs. Se n√£o tiver certeza, retorne exatamente N√£o encontrado"}>"
  },
  "fullReport": "<${m?"EXTREMELY DETAILED and extensive report in Markdown. Dive deep into all possibilities. Sections: ## Executive Summary | ## Digital Strategy | ## Deep Gaps | ## Operational Vulnerabilities | ## Competitor Profile | ## Complete Action Plan.":"Relat√≥rio EXTREMAMENTE DETALHADO e extenso em Markdown. Aprofunde-se muito nas possibilidades, sem medo de gerar um texto grande. Se√ß√µes: ## Resumo Executivo | ## Estrat√©gia Digital | ## Lacunas Profundas | ## Vulnerabilidades Operacionais | ## Perfil do Concorrente | ## Plano de A√ß√£o Completo."}>"
${d?`  ,"reclameAquiAnalysis": "<${m?"Analysis of Reclame Aqui data: complaint patterns, response rate, resolution rate, overall reputation score. If no data found, state that clearly.":"An√°lise dos dados do Reclame Aqui: padr√µes de reclama√ß√£o, taxa de resposta, taxa de resolu√ß√£o, score geral de reputa√ß√£o. Se nenhum dado foi encontrado, declare isso claramente."}>"
  ,"jusBrasilAnalysis": "<${m?"Analysis of JusBrasil data: lawsuits, labor disputes, consumer cases, legal risks. If no data found, state that clearly.":"An√°lise dos dados do JusBrasil: processos, disputas trabalhistas, casos de consumidor, riscos legais. Se nenhum dado foi encontrado, declare isso claramente."}>"
  ,"cnpjAnalysis": "<${m?"Analysis of CNPJ data: company size, founding date, registered activities, tax status. If no data found, state that clearly.":"An√°lise dos dados de CNPJ: porte da empresa, data de funda√ß√£o, atividades registradas, situa√ß√£o fiscal. Se nenhum dado foi encontrado, declare isso claramente."}>"`:""}
}
`;try{let{resolveAiForRole:t}=await e.A(55514),{config:r}=await t("lead_analysis"),i=await (0,a.generateCompletionForRole)("lead_analysis",{prompt:w,jsonMode:!0,maxTokens:8192}),n=i.text,l=i.text.match(/\{[\s\S]*\}/);n=l?l[0]:i.text.replace(/```json\n?/g,"").replace(/```\n?/g,"").trim();let d=JSON.parse(n);return o(s.placeId,d,u,c,p?.workspaceId).catch(a=>e.A(31443).then(({logger:e})=>e.error("Save analysis error",{error:a instanceof Error?a.message:"Unknown"}))),{analysis:d,usage:i.usage,provider:r.provider}}catch(i){let{logger:a}=await e.A(31443);a.error("AI Analysis Error",{error:i instanceof Error?i.message:"Unknown"});let t=(i?.message??"").toLowerCase(),r="N√£o foi poss√≠vel gerar an√°lise detalhada no momento.";return t.includes("no ai config")||t.includes("not set")?r="IA n√£o configurada. Configure um provedor em Admin ou GEMINI_API_KEY no servidor.":t.includes("403")||t.includes("restriction")||t.includes("permission")?r="API Key com restri√ß√£o (IP ou dom√≠nio). Verifique no painel do provedor.":t.includes("429")||t.includes("quota")||t.includes("rate limit")?r="Limite de uso da API atingido. Tente novamente em alguns minutos.":t.includes("401")||t.includes("invalid")||t.includes("api key")?r="Chave da API inv√°lida. Verifique a configura√ß√£o no admin.":t.includes("500")||t.includes("unavailable")?r="Servi√ßo de IA temporariamente indispon√≠vel. Tente novamente em instantes.":(t.includes("404")||t.includes("no longer available")||t.includes("newer model"))&&(r="Modelo em uso n√£o est√° mais dispon√≠vel. Atualize o modelo na configura√ß√£o de IA."),{analysis:{score:0,scoreLabel:"Indispon√≠vel",summary:r,strengths:[],weaknesses:[],painPoints:[],gaps:[],approach:"Verifique a configura√ß√£o de IA no painel admin.",contactStrategy:"",firstContactMessage:"",suggestedWhatsAppMessage:"",fullReport:`# Erro

${r}`}}}}async function o(a,t,i,o,s){try{let n=await r.prisma.lead.findUnique({where:{placeId:a}});if(!n)return;let l=o||"cl_guest_default";if(o||await r.prisma.user.upsert({where:{id:l},update:{companyName:i?.companyName,productService:i?.productService,targetAudience:i?.targetAudience,mainBenefit:i?.mainBenefit},create:{id:l,name:"Guest User",companyName:i?.companyName,productService:i?.productService,targetAudience:i?.targetAudience,mainBenefit:i?.mainBenefit}}),await r.prisma.leadAnalysis.create({data:{userId:l,leadId:n.id,score:t.score,scoreLabel:t.scoreLabel,summary:t.summary,strengths:t.strengths,weaknesses:t.weaknesses,painPoints:t.painPoints,gaps:t.gaps,status:"NEW",approach:t.approach,contactStrategy:t.contactStrategy,firstContactMessage:t.firstContactMessage,suggestedWhatsAppMessage:t.suggestedWhatsAppMessage,fullReport:t.fullReport,socialInstagram:t.socialMedia?.instagram,socialFacebook:t.socialMedia?.facebook,socialLinkedin:t.socialMedia?.linkedin}}),o&&"cl_guest_default"!==o){let{createNotification:t}=await e.A(21673),r=`/dashboard/lead/${a}`;t({userId:o,workspaceId:s??null,title:"Sua an√°lise est√° pronta",message:"A an√°lise do lead foi conclu√≠da. Clique para ver.",type:"INFO",link:r,sendEmailIfPreferred:!0,emailSubject:"Sua an√°lise est√° pronta",channel:"lead_analysis_ready"}).catch(a=>e.A(31443).then(({logger:e})=>e.error("Create notification after analysis",{error:a instanceof Error?a.message:"Unknown"})))}}catch(t){let a=t instanceof Error?t.message:"Unknown";if("u">typeof process&&process.stderr)try{let{logger:t}=await e.A(31443);t.error("Error in saveAnalysisToDb",{error:a})}catch{process.stderr.write(`saveAnalysisToDb error: ${a}
`)}}}e.s(["analyzeLead",()=>i])},48873,e=>{"use strict";var a=e.i(47909),t=e.i(74017),r=e.i(96250),i=e.i(59756),o=e.i(61916),s=e.i(74677),n=e.i(69741),l=e.i(16795),c=e.i(87718),d=e.i(95169),p=e.i(47587),u=e.i(66012),m=e.i(70101),g=e.i(26937),f=e.i(10372),h=e.i(93695);e.i(52474);var v=e.i(220),y=e.i(64397),A=e.i(8625),b=e.i(14180),x=e.i(48419),E=e.i(59615);e.i(21564);var w=e.i(71998),S=e.i(78787),I=e.i(84680);class R extends Error{status;body;constructor(e,a){super("string"==typeof a.error?a.error:"Request failed"),this.status=e,this.body=a,this.name="AnalyzeHttpError"}}async function z(a,t){let{userProfile:r,locale:i,placeId:o,name:s,...n}=a,l={...n,placeId:o,name:s},c=await S.prisma.user.findUnique({where:{id:t},select:{onboardingCompletedAt:!0,companyName:!0,productService:!0,targetAudience:!0,mainBenefit:!0,workspaces:{include:{workspace:!0},take:1}}});if(!c||0===c.workspaces.length)throw new R(404,{error:"Workspace not found"});if(null==c.onboardingCompletedAt)throw new R(403,{error:"Complete onboarding before analyzing leads",code:"REQUIRES_ONBOARDING"});let d=c.workspaces[0].workspace,p=await S.prisma.leadAnalysis.findFirst({where:{userId:t,lead:{placeId:l.placeId}},include:{lead:!0}});if(p)return{score:p.score??0,scoreLabel:p.scoreLabel??"",summary:p.summary??"",strengths:p.strengths??[],weaknesses:p.weaknesses??[],painPoints:Array.isArray(p.painPoints)?p.painPoints:[],gaps:Array.isArray(p.gaps)?p.gaps:[],approach:p.approach??"",contactStrategy:p.contactStrategy??"",firstContactMessage:p.firstContactMessage??"",suggestedWhatsAppMessage:p.suggestedWhatsAppMessage??"",fullReport:p.fullReport??null,socialMedia:{instagram:p.socialInstagram??void 0,facebook:p.socialFacebook??void 0,linkedin:p.socialLinkedin??void 0},aiProvider:void 0};if(d.leadsUsed>=d.leadsLimit)throw new R(403,{error:"Limit reached",code:"LIMIT_EXCEEDED",details:`Used: ${d.leadsUsed}, Limit: ${d.leadsLimit}`});let u="BUSINESS"===d.plan||"SCALE"===d.plan,m=r?{companyName:String(r.companyName??""),productService:String(r.productService??""),targetAudience:String(r.targetAudience??""),mainBenefit:String(r.mainBenefit??"")}:{companyName:d.companyName??c.companyName??"",productService:d.productService??c.productService??"",targetAudience:d.targetAudience??c.targetAudience??"",mainBenefit:d.mainBenefit??c.mainBenefit??""},{config:g}=await (0,w.resolveAiForRole)("lead_analysis"),{logger:f}=await e.A(31443);f.info("Analyze using AI provider",{provider:g.provider,role:"lead_analysis"});let h=await (0,E.analyzeLead)(l,m,i||"pt",t,u,{workspaceId:d.id,userId:t});return h.usage&&(0,I.recordUsageEvent)({workspaceId:d.id,userId:t,type:"AI_TOKENS",quantity:1,metadata:{provider:h.provider??g.provider,model:g.model,inputTokens:h.usage.inputTokens,outputTokens:h.usage.outputTokens}}),await S.prisma.workspace.update({where:{id:d.id},data:{leadsUsed:{increment:1}}}),await S.prisma.leadAnalysis.updateMany({where:{userId:t,workspaceId:null},data:{workspaceId:d.id}}),{...h.analysis,aiProvider:h.provider??g.provider}}async function N(a){let t=(0,b.getOrCreateRequestId)(a);try{let e=a.headers.get("x-forwarded-for")||"127.0.0.1",{success:r}=await (0,A.rateLimit)(`analyze:${e}`,15,60);if(!r)return(0,b.jsonWithRequestId)({error:"Too many requests. Try again later."},{status:429,requestId:t});let i=await a.json(),o=x.analyzeSchema.safeParse(i);if(!o.success)return(0,b.jsonWithRequestId)({error:(0,x.formatZodError)(o)},{status:400,requestId:t});let s=await (0,y.auth)();if(!s?.user?.id)return(0,b.jsonWithRequestId)({error:"Unauthorized"},{status:401,requestId:t});let n=await z(o.data,s.user.id);return(0,b.jsonWithRequestId)(n,{requestId:t})}catch(r){if(r instanceof R)return(0,b.jsonWithRequestId)(r.body,{status:r.status,requestId:t});let{logger:a}=await e.A(31443);return a.error("Analyze error",{error:r instanceof Error?r.message:"Unknown"},t),(0,b.jsonWithRequestId)({error:"Internal server error"},{status:500,requestId:t})}}e.s(["POST",()=>N],43582);var C=e.i(43582);let k=new a.AppRouteRouteModule({definition:{kind:t.RouteKind.APP_ROUTE,page:"/api/analyze/route",pathname:"/api/analyze",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/backend/src/app/api/analyze/route.ts",nextConfigOutput:"standalone",userland:C}),{workAsyncStorage:T,workUnitAsyncStorage:P,serverHooks:O}=k;function $(){return(0,r.patchFetch)({workAsyncStorage:T,workUnitAsyncStorage:P})}async function L(e,a,r){k.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let y="/api/analyze/route";y=y.replace(/\/index$/,"")||"/";let A=await k.prepare(e,a,{srcPage:y,multiZoneDraftMode:!1});if(!A)return a.statusCode=400,a.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:b,params:x,nextConfig:E,parsedUrl:w,isDraftMode:S,prerenderManifest:I,routerServerContext:R,isOnDemandRevalidate:z,revalidateOnlyGenerated:N,resolvedPathname:C,clientReferenceManifest:T,serverActionsManifest:P}=A,O=(0,n.normalizeAppPath)(y),$=!!(I.dynamicRoutes[O]||I.routes[C]),L=async()=>((null==R?void 0:R.render404)?await R.render404(e,a,w,!1):a.end("This page could not be found"),null);if($&&!S){let e=!!I.routes[C],a=I.dynamicRoutes[O];if(a&&!1===a.fallback&&!e){if(E.experimental.adapterPath)return await L();throw new h.NoFallbackError}}let q=null;!$||k.isDev||S||(q="/index"===(q=C)?"/":q);let U=!0===k.isDev||!$,_=$&&!U;P&&T&&(0,s.setManifestsSingleton)({page:y,clientReferenceManifest:T,serverActionsManifest:P});let j=e.method||"GET",D=(0,o.getTracer)(),M=D.getActiveScopeSpan(),B={params:x,prerenderManifest:I,renderOpts:{experimental:{authInterrupts:!!E.experimental.authInterrupts},cacheComponents:!!E.cacheComponents,supportsDynamicResponse:U,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:E.cacheLife,waitUntil:r.waitUntil,onClose:e=>{a.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(a,t,r,i)=>k.onRequestError(e,a,r,i,R)},sharedContext:{buildId:b}},W=new l.NodeNextRequest(e),F=new l.NodeNextResponse(a),V=c.NextRequestAdapter.fromNodeNextRequest(W,(0,c.signalFromNodeResponse)(a));try{let s=async e=>k.handle(V,B).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":a.statusCode,"next.rsc":!1});let t=D.getRootSpanAttributes();if(!t)return;if(t.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${t.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=t.get("next.route");if(r){let a=`${j} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":a}),e.updateName(a)}else e.updateName(`${j} ${y}`)}),n=!!(0,i.getRequestMeta)(e,"minimalMode"),l=async i=>{var o,l;let c=async({previousCacheEntry:t})=>{try{if(!n&&z&&N&&!t)return a.statusCode=404,a.setHeader("x-nextjs-cache","REVALIDATED"),a.end("This page could not be found"),null;let o=await s(i);e.fetchMetrics=B.renderOpts.fetchMetrics;let l=B.renderOpts.pendingWaitUntil;l&&r.waitUntil&&(r.waitUntil(l),l=void 0);let c=B.renderOpts.collectedTags;if(!$)return await (0,u.sendResponse)(W,F,o,B.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),a=(0,m.toNodeOutgoingHttpHeaders)(o.headers);c&&(a[f.NEXT_CACHE_TAGS_HEADER]=c),!a["content-type"]&&e.type&&(a["content-type"]=e.type);let t=void 0!==B.renderOpts.collectedRevalidate&&!(B.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&B.renderOpts.collectedRevalidate,r=void 0===B.renderOpts.collectedExpire||B.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:B.renderOpts.collectedExpire;return{value:{kind:v.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:a},cacheControl:{revalidate:t,expire:r}}}}catch(a){throw(null==t?void 0:t.isStale)&&await k.onRequestError(e,a,{routerKind:"App Router",routePath:y,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:_,isOnDemandRevalidate:z})},!1,R),a}},d=await k.handleResponse({req:e,nextConfig:E,cacheKey:q,routeKind:t.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:I,isRoutePPREnabled:!1,isOnDemandRevalidate:z,revalidateOnlyGenerated:N,responseGenerator:c,waitUntil:r.waitUntil,isMinimalMode:n});if(!$)return null;if((null==d||null==(o=d.value)?void 0:o.kind)!==v.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(l=d.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});n||a.setHeader("x-nextjs-cache",z?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),S&&a.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let h=(0,m.fromNodeOutgoingHttpHeaders)(d.value.headers);return n&&$||h.delete(f.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||a.getHeader("Cache-Control")||h.get("Cache-Control")||h.set("Cache-Control",(0,g.getCacheControlHeader)(d.cacheControl)),await (0,u.sendResponse)(W,F,new Response(d.value.body,{headers:h,status:d.value.status||200})),null};M?await l(M):await D.withPropagatedContext(e.headers,()=>D.trace(d.BaseServerSpan.handleRequest,{spanName:`${j} ${y}`,kind:o.SpanKind.SERVER,attributes:{"http.method":j,"http.target":e.url}},l))}catch(a){if(a instanceof h.NoFallbackError||await k.onRequestError(e,a,{routerKind:"App Router",routePath:O,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:_,isOnDemandRevalidate:z})},!1,R),$)throw a;return await (0,u.sendResponse)(W,F,new Response(null,{status:500})),null}}e.s(["handler",()=>L,"patchFetch",()=>$,"routeModule",()=>k,"serverHooks",()=>O,"workAsyncStorage",()=>T,"workUnitAsyncStorage",()=>P],48873)},10906,e=>{e.v(e=>Promise.resolve().then(()=>e(78787)))},99913,e=>{e.v(a=>Promise.all(["server/chunks/backend_src_lib_ai_encrypt_ts_ff8430df._.js"].map(a=>e.l(a))).then(()=>a(85981)))},82269,e=>{e.v(e=>Promise.resolve().then(()=>e(84680)))},55514,e=>{e.v(a=>Promise.all(["server/chunks/backend_src_lib_ai_index_ts_72229486._.js"].map(a=>e.l(a))).then(()=>a(50131)))},31443,e=>{e.v(e=>Promise.resolve().then(()=>e(75225)))},21673,e=>{e.v(a=>Promise.all(["server/chunks/[root-of-the-server]__cb2354d6._.js","server/chunks/[root-of-the-server]__63fbfec1._.js"].map(a=>e.l(a))).then(()=>a(93594)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__cc56a9d5._.js.map