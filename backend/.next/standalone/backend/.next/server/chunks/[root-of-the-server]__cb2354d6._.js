module.exports=[21517,(e,a,i)=>{a.exports=e.x("http",()=>require("http"))},24836,(e,a,i)=>{a.exports=e.x("https",()=>require("https"))},33405,(e,a,i)=>{a.exports=e.x("child_process",()=>require("child_process"))},6461,(e,a,i)=>{a.exports=e.x("zlib",()=>require("zlib"))},37405,e=>{"use strict";var a=e.i(54799);let i="aes-256-gcm";function t(){let e=process.env.AI_CONFIG_ENCRYPTION_KEY||process.env.AUTH_SECRET;if(!e||e.length<16)throw Error("AI_CONFIG_ENCRYPTION_KEY or AUTH_SECRET (min 16 chars) required for email config encryption");return(0,a.scryptSync)(e,"email-config-salt",32)}function n(e){let n=t(),l=(0,a.randomBytes)(16),r=(0,a.createCipheriv)(i,n,l),o=Buffer.concat([r.update(e,"utf8"),r.final()]),s=r.getAuthTag();return Buffer.concat([l,s,o]).toString("hex")}function l(e){let n=t(),l=Buffer.from(e,"hex");if(l.length<32)throw Error("Invalid encrypted value");let r=l.subarray(0,16),o=l.subarray(16,32),s=l.subarray(32),d=(0,a.createDecipheriv)(i,n,r);return d.setAuthTag(o),d.update(s).toString("utf8")+d.final("utf8")}e.s(["decryptEmailSecret",()=>l,"encryptEmailSecret",()=>n])},93594,e=>{"use strict";var a=e.i(78787),i=e.i(44117),t=e.i(99925);let n=[{key:"lead_analysis_ready",name:"AnÃ¡lise de lead pronta"},{key:"team_invite",name:"Convite para workspace"},{key:"admin_broadcast",name:"Broadcast admin"}];async function l(e){let i=await a.prisma.notificationChannelConfig.findUnique({where:{key:e},select:{appEnabled:!0,emailEnabled:!0}});return i?{appEnabled:i.appEnabled,emailEnabled:i.emailEnabled}:{appEnabled:!0,emailEnabled:!0}}async function r(){let e=new Map((await a.prisma.notificationChannelConfig.findMany({select:{key:!0,appEnabled:!0,emailEnabled:!0}})).map(e=>[e.key,{appEnabled:e.appEnabled,emailEnabled:e.emailEnabled}]));return n.map(a=>{let i=e.get(a.key)??{appEnabled:!0,emailEnabled:!0};return{key:a.key,name:a.name,appEnabled:i.appEnabled,emailEnabled:i.emailEnabled}})}async function o(e){let{userId:n,workspaceId:r,title:o,message:s,type:d="INFO",link:p,sendEmailIfPreferred:c=!1,emailSubject:m,channel:f}=e,u=!0,E=!0;if(f){let e=await l(f);u=e.appEnabled,E=e.emailEnabled}let y="";if(u&&(y=(await a.prisma.notification.create({data:{userId:n,workspaceId:r??void 0,title:o,message:s,type:d,link:p??void 0},select:{id:!0}})).id),c&&E){let e=await a.prisma.user.findUnique({where:{id:n},select:{email:!0,notifyByEmail:!0}});if(e?.email&&e.notifyByEmail){let a=m??o,n=(0,t.notificationTemplate)(o,s,p);(0,i.sendEmail)(e.email,a,n)}}return{id:y}}async function s(e){let n=await a.prisma.user.findMany({where:{email:{not:null},disabledAt:null},select:{id:!0,email:!0,notifyByEmail:!0}}),r=!0,o=!1;if(e.channel){let a=await l(e.channel);r=a.appEnabled,o=a.emailEnabled}if(r&&await a.prisma.notification.createMany({data:n.map(a=>({userId:a.id,title:e.title,message:e.message,type:e.type??"SYSTEM",link:e.link??void 0}))}),o){let a=e.emailSubject??e.title,l=(0,t.notificationTemplate)(e.title,e.message,e.link??void 0);for(let e of n)e.email&&e.notifyByEmail&&(0,i.sendEmail)(e.email,a,l)}return{count:n.length}}e.s(["NOTIFICATION_CHANNELS",0,n,"createNotification",()=>o,"createNotificationForAllUsers",()=>s,"getChannelsWithConfig",()=>r])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__cb2354d6._.js.map