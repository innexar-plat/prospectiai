module.exports=[54799,(e,t,a)=>{t.exports=e.x("crypto",()=>require("crypto"))},63021,(e,t,a)=>{t.exports=e.x("@prisma/client-2c3a283f134fdcb6",()=>require("@prisma/client-2c3a283f134fdcb6"))},78787,e=>{"use strict";var t=e.i(63021);let a=e.g.prisma||new t.PrismaClient({log:["error"]});e.s(["prisma",0,a])},93695,(e,t,a)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},32319,(e,t,a)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,a)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},18622,(e,t,a)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,a)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},70406,(e,t,a)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},20635,(e,t,a)=>{t.exports=e.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},48419,e=>{"use strict";var t=e.i(69719);let a=t.z.object({email:t.z.string().email("Invalid email").transform(e=>e.trim().toLowerCase()),password:t.z.string().min(8,"Password must be at least 8 characters"),name:t.z.string().max(200).optional().transform(e=>e?.trim()||void 0)}),r=t.z.object({companyName:t.z.string().max(500).optional().transform(e=>e?.trim()||void 0),productService:t.z.string().max(500).optional().transform(e=>e?.trim()||void 0),targetAudience:t.z.string().max(500).optional().transform(e=>e?.trim()||void 0),mainBenefit:t.z.string().max(500).optional().transform(e=>e?.trim()||void 0)}),i=t.z.object({textQuery:t.z.string().min(1,"textQuery is required").max(500),includedType:t.z.string().max(100).optional(),pageSize:t.z.coerce.number().int().min(1).max(100).optional(),pageToken:t.z.string().optional(),hasWebsite:t.z.enum(["yes","no"]).optional(),hasPhone:t.z.enum(["yes","no"]).optional(),city:t.z.string().max(200).optional(),state:t.z.string().max(100).optional(),country:t.z.string().max(100).optional(),radiusKm:t.z.coerce.number().min(1).max(100).optional()}),o=t.z.object({textQuery:t.z.string().min(1,"textQuery is required").max(500),includedType:t.z.string().max(100).optional(),pageSize:t.z.coerce.number().int().min(1).max(60).optional(),city:t.z.string().max(200).optional(),state:t.z.string().max(100).optional()}),n=t.z.object({placeId:t.z.string().min(1,"placeId is required"),name:t.z.string().min(1,"Business name is required"),userProfile:t.z.record(t.z.string(),t.z.unknown()).optional(),locale:t.z.string().optional(),websiteUri:t.z.string().optional(),website:t.z.string().optional(),formattedAddress:t.z.string().optional(),address:t.z.string().optional(),nationalPhoneNumber:t.z.string().optional(),internationalPhoneNumber:t.z.string().optional(),phone:t.z.string().optional(),rating:t.z.number().optional(),userRatingCount:t.z.number().optional(),reviewCount:t.z.number().optional(),types:t.z.array(t.z.string()).optional(),primaryType:t.z.string().optional(),businessStatus:t.z.string().optional(),reviews:t.z.array(t.z.object({rating:t.z.number(),text:t.z.object({text:t.z.string()}).optional(),authorAttribution:t.z.object({displayName:t.z.string()}).optional(),relativePublishTimeDescription:t.z.string().optional()})).optional()}),s=t.z.object({name:t.z.string().max(200).optional().transform(e=>e?.trim()||void 0),phone:t.z.string().max(50).optional().transform(e=>e?.trim()||void 0),address:t.z.string().max(500).optional().transform(e=>e?.trim()||void 0),linkedInUrl:t.z.string().max(500).optional().transform(e=>e?.trim()||void 0),instagramUrl:t.z.string().max(500).optional().transform(e=>e?.trim()||void 0),facebookUrl:t.z.string().max(500).optional().transform(e=>e?.trim()||void 0),websiteUrl:t.z.string().max(500).optional().transform(e=>e?.trim()||void 0),image:t.z.string().max(2e3).optional().transform(e=>e?.trim()||void 0),notifyByEmail:t.z.boolean().optional(),notifyWeeklyReport:t.z.boolean().optional(),notifyLeadAlerts:t.z.boolean().optional()}),l=t.z.object({useProfile:t.z.boolean().optional().default(!0),companyName:t.z.string().max(500).optional().transform(e=>e?.trim()||void 0),city:t.z.string().max(200).optional().transform(e=>e?.trim()||void 0),state:t.z.string().max(100).optional().transform(e=>e?.trim()||void 0),productService:t.z.string().max(500).optional().transform(e=>e?.trim()||void 0),targetAudience:t.z.string().max(500).optional().transform(e=>e?.trim()||void 0),mainBenefit:t.z.string().max(500).optional().transform(e=>e?.trim()||void 0),address:t.z.string().max(500).optional().transform(e=>e?.trim()||void 0),websiteUrl:t.z.string().max(500).optional().transform(e=>e?.trim()||void 0),linkedInUrl:t.z.string().max(500).optional().transform(e=>e?.trim()||void 0),instagramUrl:t.z.string().max(500).optional().transform(e=>e?.trim()||void 0),facebookUrl:t.z.string().max(500).optional().transform(e=>e?.trim()||void 0)}),m=t.z.object({companyName:t.z.string().max(500).optional().transform(e=>e?.trim()||void 0),productService:t.z.string().max(500).optional().transform(e=>e?.trim()||void 0),targetAudience:t.z.string().max(500).optional().transform(e=>e?.trim()||void 0),mainBenefit:t.z.string().max(500).optional().transform(e=>e?.trim()||void 0),address:t.z.string().max(500).optional().transform(e=>e?.trim()||void 0),linkedInUrl:t.z.string().max(500).optional().transform(e=>e?.trim()||void 0),instagramUrl:t.z.string().max(500).optional().transform(e=>e?.trim()||void 0),facebookUrl:t.z.string().max(500).optional().transform(e=>e?.trim()||void 0),websiteUrl:t.z.string().max(500).optional().transform(e=>e?.trim()||void 0),logoUrl:t.z.string().max(2e3).optional().transform(e=>e?.trim()||void 0)}),c=t.z.object({planId:t.z.string().min(1,"planId is required"),locale:t.z.string().max(10).optional(),cycle:t.z.enum(["monthly","annual"]).optional(),interval:t.z.enum(["monthly","annual"]).optional(),card_token_id:t.z.string().max(500).optional(),scheduleAtPeriodEnd:t.z.boolean().optional()}),p=t.z.object({planId:t.z.enum(["FREE","BASIC","PRO","BUSINESS","SCALE"],{message:"planId must be a valid plan key"})}),d=t.z.object({token:t.z.string().min(1,"token is required"),issuer_id:t.z.string().optional(),payment_method_id:t.z.string().min(1,"payment_method_id is required"),transaction_amount:t.z.coerce.number().positive("transaction_amount must be positive"),installments:t.z.number().int().min(1).optional(),payer:t.z.object({email:t.z.string().email().optional(),identification:t.z.object({type:t.z.string().optional(),number:t.z.string().optional()}).optional()}).optional(),planId:t.z.string().min(1,"planId is required"),interval:t.z.enum(["monthly","annual"])}),u=t.z.object({limit:t.z.coerce.number().int().min(1).max(100).optional(),offset:t.z.coerce.number().int().min(0).optional(),workspaceId:t.z.string().min(1).optional()}),g=t.z.object({limit:t.z.coerce.number().int().min(1).max(100).optional(),offset:t.z.coerce.number().int().min(0).optional(),search:t.z.string().min(1).max(200).optional()}),f=t.z.object({reason:t.z.string().max(500).optional()}),y=t.z.object({sendEmail:t.z.boolean().optional(),temporaryPassword:t.z.string().min(8,"Password must be at least 8 characters").optional()}).refine(e=>!0===e.sendEmail||null!=e.temporaryPassword&&e.temporaryPassword.length>=8,{message:"Either sendEmail true or temporaryPassword (min 8 chars) is required"}),E=t.z.object({plan:t.z.enum(["FREE","BASIC","PRO","BUSINESS","SCALE"]).optional(),leadsLimit:t.z.coerce.number().int().min(0).optional()}),z=t.z.object({email:t.z.string().email("Valid email is required").transform(e=>e.trim().toLowerCase())}),A=t.z.object({email:t.z.string().min(1,"Email is required").email("Invalid email address")}),h=t.z.object({token:t.z.string().min(1,"Token and password are required"),password:t.z.string().min(8,"Password must be at least 8 characters")}),x=t.z.object({code:t.z.string().length(6,"Code must be 6 digits").regex(/^\d{6}$/,"Code must be 6 digits")}),b=t.z.object({placeId:t.z.string().min(1,"placeId is required")}),I=t.z.object({format:t.z.enum(["json","csv"]).optional()}),v=t.z.object({limit:t.z.coerce.number().int().min(1).max(100).optional(),offset:t.z.coerce.number().int().min(0).optional()}),S=t.z.object({status:t.z.enum(["NEW","CONTACTED","CONVERTED","LOST"]).optional(),isFavorite:t.z.boolean().optional()}).refine(e=>void 0!==e.status||void 0!==e.isFavorite,{message:"At least one of status or isFavorite is required"}),w=t.z.object({userIdToRemove:t.z.string().min(1,"User ID to remove is required")}),C=n.extend({userId:t.z.string().optional()}),P=t.z.object({role:t.z.enum(["lead_analysis","viability"]),provider:t.z.enum(["GEMINI","OPENAI","CLOUDFLARE"]),model:t.z.string().min(1).max(200),apiKey:t.z.string().optional(),cloudflareAccountId:t.z.string().max(100).optional(),enabled:t.z.boolean().optional().default(!0)}),k=t.z.object({role:t.z.enum(["lead_analysis","viability"]).optional(),provider:t.z.enum(["GEMINI","OPENAI","CLOUDFLARE"]).optional(),model:t.z.string().min(1).max(200).optional(),apiKey:t.z.string().optional(),cloudflareAccountId:t.z.string().max(100).optional().nullable(),enabled:t.z.boolean().optional()}),R=t.z.object({role:t.z.enum(["lead_analysis","viability"]),provider:t.z.enum(["SERPER","TAVILY"]),apiKey:t.z.string().optional(),maxResults:t.z.number().int().min(1).max(20).optional().default(5),enabled:t.z.boolean().optional().default(!0)});function N(e){let t=e.error.issues[0];return t?`${t.path.join(".")||"body"}: ${t.message}`:"Validation failed"}e.s(["adminListQuerySchema",0,u,"adminResetPasswordSchema",0,y,"adminWorkspaceUpdateSchema",0,E,"aiConfigCreateSchema",0,P,"aiConfigUpdateSchema",0,k,"analyzeSchema",0,n,"checkoutSchema",0,c,"companyAnalysisSchema",0,l,"detailsQuerySchema",0,b,"exportLeadsQuerySchema",0,I,"forgotSchema",0,A,"formatZodError",()=>N,"leadStatusSchema",0,S,"marketReportSchema",0,o,"onboardingCompleteSchema",0,r,"processPaymentSchema",0,d,"profileSchema",0,s,"registerSchema",0,a,"resetSchema",0,h,"scheduleDowngradeSchema",0,p,"searchHistoryQuerySchema",0,v,"searchSchema",0,i,"supportDeactivateSchema",0,f,"supportUsersListSchema",0,g,"teamInviteSchema",0,z,"teamRemoveSchema",0,w,"twoFaCodeSchema",0,x,"v1AnalyzeSchema",0,C,"webSearchConfigSchema",0,R,"workspaceProfileSchema",0,m])},14180,e=>{"use strict";var t=e.i(89171),a=e.i(54799);function r(e){if(!e?.headers?.get)return a.default.randomUUID();let t=e.headers.get("x-request-id")?.trim();return t&&t.length>0?t:a.default.randomUUID()}function i(e,a){let r=t.NextResponse.json(e,{status:a.status??200});return r.headers.set("x-request-id",a.requestId),r}e.s(["getOrCreateRequestId",()=>r,"jsonWithRequestId",()=>i])},75225,e=>{"use strict";let t={info:0,warn:1,error:2},a="error"===process.env.LOG_LEVEL?"error":"info";function r(e,r,i,o){if(!(t[e]>=t[a]))return;let n=JSON.stringify({level:e,message:r,timestamp:new Date().toISOString(),...o&&{requestId:o},...i});"error"===e?process.stderr.write(n+"\n"):process.stdout.write(n+"\n")}function i(e){let t=e.headers.get("x-request-id");if(t&&"string"==typeof t)return t}e.s(["getRequestId",()=>i,"logger",0,{info(e,t,a){r("info",e,t,a)},warn(e,t,a){r("warn",e,t,a)},error(e,t,a){r("error",e,t,a)}}])},22734,(e,t,a)=>{t.exports=e.x("fs",()=>require("fs"))},46786,(e,t,a)=>{t.exports=e.x("os",()=>require("os"))},79594,(e,t,a)=>{t.exports=e.x("dns",()=>require("dns"))},4446,(e,t,a)=>{t.exports=e.x("net",()=>require("net"))},55004,(e,t,a)=>{t.exports=e.x("tls",()=>require("tls"))},14747,(e,t,a)=>{t.exports=e.x("path",()=>require("path"))},88947,(e,t,a)=>{t.exports=e.x("stream",()=>require("stream"))},27699,(e,t,a)=>{t.exports=e.x("events",()=>require("events"))},24361,(e,t,a)=>{t.exports=e.x("util",()=>require("util"))},92509,(e,t,a)=>{t.exports=e.x("url",()=>require("url"))},8625,e=>{"use strict";var t=e.i(42512),a=e.i(75225);let r=null;async function i(e,i,o){try{let n=function(){if(r)return r;let e=process.env.REDIS_URL||"redis://localhost:6379";try{return(r=new t.default(e,{maxRetriesPerRequest:1,retryStrategy:e=>e>2?null:Math.min(200*e,1e3),lazyConnect:!0})).on("error",()=>{r=null}),r}catch{return null}}();if(!n)return a.logger.warn("Redis down, bypassing rate limit",{identifier:e}),{success:!0,remaining:i,reset:0};await n.connect().catch(()=>{});let s=`ratelimit:${e}`,l=await n.get(s),m=l?parseInt(l):0;if(m>=i){let e=await n.ttl(s);return{success:!1,remaining:0,reset:Date.now()+(e>0?1e3*e:1e3*o)}}let c=n.multi();return c.incr(s),l||c.expire(s,o),await c.exec(),{success:!0,remaining:i-(m+1),reset:Date.now()+1e3*o}}catch(e){return a.logger.error("Rate limit error",{error:e instanceof Error?e.message:"Unknown"}),{success:!0,remaining:i,reset:0}}}e.s(["rateLimit",()=>i])},21564,71998,e=>{"use strict";var t=e.i(99612),a=e.i(71586),r=e.i(12321);let i={lead_analysis:"gemini-flash-latest",viability:"gemini-2.5-flash",company_analysis:"gemini-2.5-flash"};async function o(e){let o=await l(e);if(o||"viability"!==e&&"company_analysis"!==e||(o=await l("company_analysis"===e?"viability":"lead_analysis")),o){let e=function(e,i,o,n){switch(e){case"GEMINI":return(0,t.createGeminiAdapter)(o,i);case"OPENAI":return(0,a.createOpenAIAdapter)(o,i);case"CLOUDFLARE":return(0,r.createCloudflareAdapter)(o,i,n);default:throw Error(`Unknown AI provider: ${e}`)}}(o.provider,o.model,o.apiKey,o.accountId);return{config:{provider:o.provider,model:o.model,apiKey:o.apiKey},adapter:e}}let n=process.env.GEMINI_API_KEY;if(!n)throw Error(`No AI config for role "${e}" and GEMINI_API_KEY not set`);let s=i[e],m=(0,t.createGeminiAdapter)(n,s);return{config:{provider:"GEMINI",model:s,apiKey:n},adapter:m}}async function n(e,t){let{adapter:a}=await o(e);return a.generateCompletion(t)}let s={lead_analysis:"LEAD_ANALYSIS",viability:"VIABILITY",company_analysis:"COMPANY_ANALYSIS"};async function l(t){try{let{prisma:a}=await e.A(10906),{decryptApiKey:r}=await e.A(99913),i=s[t],o=await a.aiProviderConfig.findFirst({where:{role:i,enabled:!0},orderBy:{updatedAt:"desc"}});if(!o||!o.apiKeyEncrypted)return null;let n=r(o.apiKeyEncrypted);return{provider:o.provider,model:o.model,apiKey:n,accountId:o.cloudflareAccountId??void 0}}catch{return null}}e.s(["generateCompletionForRole",()=>n,"resolveAiForRole",()=>o],71998),e.s([],21564)},87040,e=>{"use strict";async function t(e,a,r=5){let i=await fetch("https://google.serper.dev/search",{method:"POST",headers:{"X-API-KEY":e,"Content-Type":"application/json"},body:JSON.stringify({q:a,num:r})});if(!i.ok){let e=await i.text();throw Error(`Serper API error ${i.status}: ${e}`)}return((await i.json()).organic??[]).slice(0,r).map(e=>({title:e.title??"",link:e.link??"",snippet:e.snippet}))}let a={lead_analysis:"LEAD_ANALYSIS",viability:"VIABILITY",company_analysis:"COMPANY_ANALYSIS"};async function r(t){try{let{prisma:r}=await e.A(10906),{decryptApiKey:i}=await e.A(99913),o=a[t],n=await r.webSearchConfig.findUnique({where:{role:o}});if(!n||!n.enabled||!n.apiKeyEncrypted)return null;let s=i(n.apiKeyEncrypted);return{provider:n.provider,apiKey:s,maxResults:n.maxResults??5}}catch{return null}}async function i(a,i,o){let n=await r(a);if(!n||0===i.length)return"";let s=[],l=0;for(let e of i.slice(0,"company_analysis"===a?6:5)){if(!e.trim())continue;let{label:a,emoji:r}=function(e){let t=e.toLowerCase();return t.includes("reclame aqui")?{label:"Reclame Aqui â€” ReputaÃ§Ã£o do Consumidor",emoji:"ðŸ”´"}:t.includes("jusbrasil")?{label:"JusBrasil â€” Processos Judiciais",emoji:"âš–ï¸"}:t.includes("cnpj")?{label:"CNPJ â€” Dados Empresariais",emoji:"ðŸ¢"}:t.includes("instagram")?{label:"Redes sociais â€” Instagram",emoji:"ðŸ“±"}:t.includes("facebook")?{label:"Redes sociais â€” Facebook",emoji:"ðŸ“±"}:t.includes("linkedin")?{label:"Redes sociais â€” LinkedIn",emoji:"ðŸ“±"}:t.includes("avaliaÃ§Ãµes google")||t.includes("google reviews")?{label:"AvaliaÃ§Ãµes Google",emoji:"â­"}:{label:`Busca Web â€” "${e}"`,emoji:"ðŸ”"}}(e),i={label:a,emoji:r,items:[]};try{if("SERPER"===n.provider){let a=await t(n.apiKey,e.trim(),Math.min(n.maxResults,5));for(let e of(l+=1,a))i.items.push({title:e.title,link:e.link,snippet:e.snippet??""})}}catch{}s.push(i)}if(o?.workspaceId&&l>0){let{recordUsageEvent:t}=await e.A(82269);t({workspaceId:o.workspaceId,userId:o.userId??void 0,type:"SERPER_REQUEST",quantity:l})}let m=function(e){let t=[];for(let a of e)if(0!==a.items.length){for(let e of(t.push(`### ${a.emoji} ${a.label}`),a.items))t.push(`- **${e.title}** â€” [${e.link}](${e.link})`),e.snippet&&t.push(`  ${e.snippet}`);t.push("")}return t.join("\n")}(s);return m.trim()?`## ðŸ“Š Contexto da Web (dados reais coletados â€” use-os na an\xe1lise e cite as fontes)

${m}`:""}e.s(["getWebContextForRole",()=>i],87040)},45881,e=>{"use strict";let t={FREE:["MAPEAMENTO","INTELIGENCIA_LEADS"],BASIC:["MAPEAMENTO","INTELIGENCIA_LEADS"],PRO:["MAPEAMENTO","INTELIGENCIA_LEADS","ANALISE_CONCORRENCIA","ACAO_COMERCIAL"],BUSINESS:["MAPEAMENTO","INTELIGENCIA_MERCADO","ANALISE_CONCORRENCIA","ANALISE_MINHA_EMPRESA","INTELIGENCIA_LEADS","ACAO_COMERCIAL"],SCALE:["MAPEAMENTO","INTELIGENCIA_MERCADO","ANALISE_CONCORRENCIA","ANALISE_MINHA_EMPRESA","INTELIGENCIA_LEADS","ACAO_COMERCIAL"]};function a(e){return t[e]??t.FREE}function r(e,t){return a(e).includes(t)}e.s(["MODULES",0,{MAPEAMENTO:{key:"MAPEAMENTO",name:"Mapeamento",shortDescription:"Buscar empresas por nicho e regiÃ£o",features:["Buscar empresas por nicho","Filtrar por regiÃ£o","Filtros por site e telefone","Lista de resultados paginada"],deliverables:["Lista estruturada de empresas","HistÃ³rico de buscas"],backendStatus:"done"},INTELIGENCIA_MERCADO:{key:"INTELIGENCIA_MERCADO",name:"InteligÃªncia de Mercado",shortDescription:"AnÃ¡lise de mercado local e tendÃªncias por regiÃ£o",features:["Quantidade de empresas por segmento","Crescimento por categoria na regiÃ£o","SaturaÃ§Ã£o da regiÃ£o","Ticket mÃ©dio estimado","Score de maturidade digital"],deliverables:["RelatÃ³rio de mercado automÃ¡tico","AnÃ¡lise comparativa por bairro","TendÃªncia local"],backendStatus:"partial"},ANALISE_CONCORRENCIA:{key:"ANALISE_CONCORRENCIA",name:"AnÃ¡lise de ConcorrÃªncia",shortDescription:"Ranking e gaps vs concorrentes no raio",features:["Quantos concorrentes no raio","Quem tem mais avaliaÃ§Ãµes","PresenÃ§a digital (site, redes)","Quem nÃ£o tem site / redes","Ranking competitivo"],deliverables:["Score competitivo","Gap analysis","Lista de oportunidades"],backendStatus:"partial"},ANALISE_MINHA_EMPRESA:{key:"ANALISE_MINHA_EMPRESA",name:"AnÃ¡lise da minha empresa",shortDescription:"DiagnÃ³stico da prÃ³pria empresa com Reclame Aqui, Google, redes sociais e IA",features:["ReputaÃ§Ã£o Reclame Aqui e reclamaÃ§Ãµes","AvaliaÃ§Ãµes Google (rating e reviews)","PresenÃ§a em redes sociais (link + dados pÃºblicos)","Oportunidades e nicho sugerido","Modelo de negÃ³cio sugerido"],deliverables:["RelatÃ³rio de anÃ¡lise da empresa","SeÃ§Ã£o redes sociais","RecomendaÃ§Ãµes e prÃ³ximos passos"],backendStatus:"done"},INTELIGENCIA_LEADS:{key:"INTELIGENCIA_LEADS",name:"InteligÃªncia de Leads",shortDescription:"Score e classificaÃ§Ã£o de potencial do lead",features:["Score de investimento","Score de urgÃªncia","ClassificaÃ§Ã£o frio / morno / quente","Potencial financeiro","Probabilidade de compra"],deliverables:["Ranking de leads","Filtro por potencial","SugestÃ£o de abordagem"],backendStatus:"partial"},ACAO_COMERCIAL:{key:"ACAO_COMERCIAL",name:"AÃ§Ã£o Comercial",shortDescription:"Abordagem pronta para contato",features:["Script de ligaÃ§Ã£o personalizado","E-mail pronto","Mensagem WhatsApp","Pitch adaptado ao nicho","SequÃªncia de follow-up"],deliverables:["Lead pronto para contato","Economia de tempo","Maior conversÃ£o"],backendStatus:"partial"}},"getModulesForPlan",()=>a,"planHasModule",()=>r])},84680,e=>{"use strict";var t=e.i(78787);function a(a){let{workspaceId:r,userId:i,type:o,quantity:n=1,metadata:s}=a;t.prisma.usageEvent.create({data:{workspaceId:r,userId:i??void 0,type:o,quantity:n,metadata:s||void 0}}).catch(t=>{e.A(31443).then(({logger:e})=>e.warn("Usage event record failed",{workspaceId:r,type:o,error:t instanceof Error?t.message:"Unknown"}))})}async function r(e){if(0===e.length)return new Map;let a={googlePlacesSearch:0,googlePlacesDetails:0,serperRequests:0,aiInputTokens:0,aiOutputTokens:0},r=new Map(e.map(e=>[e,{...a}]));for(let a of(await t.prisma.usageEvent.groupBy({by:["workspaceId","type"],where:{workspaceId:{in:e},type:{not:"AI_TOKENS"}},_sum:{quantity:!0}}))){let e=r.get(a.workspaceId),t=a._sum.quantity??0;"GOOGLE_PLACES_SEARCH"===a.type?e.googlePlacesSearch=t:"GOOGLE_PLACES_DETAILS"===a.type?e.googlePlacesDetails=t:"SERPER_REQUEST"===a.type&&(e.serperRequests=t)}for(let a of(await t.prisma.usageEvent.findMany({where:{workspaceId:{in:e},type:"AI_TOKENS"},select:{workspaceId:!0,metadata:!0}}))){let e=r.get(a.workspaceId),t=a.metadata;t&&(e.aiInputTokens+=Number(t.inputTokens)||0,e.aiOutputTokens+=Number(t.outputTokens)||0)}return r}e.s(["getWorkspaceUsage",()=>r,"recordUsageEvent",()=>a])},43757,49292,e=>{"use strict";function t(e){return new Promise(t=>setTimeout(t,e))}let a=e=>429===e||e>=500&&e<600;async function r(e,i,o={}){let{timeoutMs:n=15e3,maxRetries:s=3,initialBackoffMs:l=1e3,retryStatuses:m=a}=o,c=null,p=null;for(let a=0;a<=s;a++){let r=new AbortController,o=setTimeout(()=>r.abort(),n),d={...i,signal:r.signal};try{let r=await fetch(e,d);if(clearTimeout(o),c=r,a<s&&m(r.status)){let e=l*Math.pow(2,a);await t(e);continue}return r}catch(e){if(clearTimeout(o),p=e instanceof Error?e:Error(String(e)),a<s){let e=l*Math.pow(2,a);await t(e);continue}throw p}}if(c)return c;throw p??Error("fetchWithRetry failed")}e.s(["fetchWithRetry",()=>r],49292);let i="https://places.googleapis.com/v1/places",o=new Map;async function n(e){let t,a=process.env.GOOGLE_PLACES_API_KEY;if(!a)throw Error("GOOGLE_PLACES_API_KEY not configured");let n=Math.min(20,Math.max(1,e.pageSize??20));if(e.pageToken){let a=o.get(e.pageToken);t=a?{...a.body,pageToken:e.pageToken}:{textQuery:e.textQuery,pageSize:n,languageCode:e.languageCode||"pt-BR",regionCode:e.regionCode||"BR",pageToken:e.pageToken}}else if(t={textQuery:e.textQuery,pageSize:n,languageCode:e.languageCode||"pt-BR",regionCode:e.regionCode||"BR"},e.includedType&&(t.includedType=e.includedType),e.locationBias?.center&&e.locationBias?.radius!=null){let a=Math.min(5e4,Math.max(0,e.locationBias.radius));t.locationBias={circle:{center:{latitude:e.locationBias.center.latitude,longitude:e.locationBias.center.longitude},radius:a}}}let s=await r(`${i}:searchText`,{method:"POST",headers:{"Content-Type":"application/json","X-Goog-Api-Key":a,"X-Goog-FieldMask":"places.id,places.displayName,places.formattedAddress,places.nationalPhoneNumber,places.internationalPhoneNumber,places.websiteUri,places.googleMapsUri,places.rating,places.userRatingCount,places.types,places.businessStatus,places.primaryType,places.primaryTypeDisplayName,nextPageToken"},body:JSON.stringify(t)},{timeoutMs:15e3,maxRetries:3});if(!s.ok){let e=await s.text();throw Error(`Places API error (${s.status}): ${e}`)}let l=await s.json();if(l.nextPageToken){let e={...t};delete e.pageToken,o.set(l.nextPageToken,{body:e,ts:Date.now()}),o.size>50&&function(){let e=Date.now();for(let[t,a]of o)e-a.ts>6e5&&o.delete(t)}()}return{places:l.places||[],nextPageToken:l.nextPageToken}}async function s(e){let t,{maxPlaces:a,...r}=e,i=Math.max(1,Math.min(a,60)),o=[];for(;o.length<i;){let e=await n({...r,pageSize:Math.min(20,i-o.length),pageToken:t,locationBias:t?void 0:r.locationBias}),a=e.places??[];if(o.push(...a),0===a.length||!e.nextPageToken||o.length>=i)break;t=e.nextPageToken,await new Promise(e=>setTimeout(e,400))}return{places:o.slice(0,i)}}async function l(e){let t=process.env.GOOGLE_PLACES_API_KEY;if(!t)throw Error("GOOGLE_PLACES_API_KEY not configured");let a=await r(`${i}/${e}`,{method:"GET",headers:{"X-Goog-Api-Key":t,"X-Goog-FieldMask":"id,displayName,formattedAddress,nationalPhoneNumber,internationalPhoneNumber,websiteUri,googleMapsUri,rating,userRatingCount,types,businessStatus,currentOpeningHours,reviews,primaryType,primaryTypeDisplayName"}},{timeoutMs:15e3,maxRetries:2});if(!a.ok){let e=await a.text();throw Error(`Place Details error (${a.status}): ${e}`)}return await a.json()}e.s(["PLACES_PAGE_SIZE_MAX",0,20,"getPlaceDetails",()=>l,"textSearch",()=>n,"textSearchAllPages",()=>s],43757)},10266,e=>{"use strict";var t=e.i(49292);async function a(e,r,i="Brasil"){let o,n=process.env.GOOGLE_PLACES_API_KEY;if(!n)return null;let s=[e.trim()];r?.trim()&&s.push(r.trim()),s.push(i);let l=s.join(", "),m=(o=i.trim().toLowerCase()).includes("brasil")||"br"===o?"br":o.includes("argentina")||"ar"===o?"ar":o.includes("mÃ©xico")||o.includes("mexico")||"mx"===o?"mx":o.includes("estados unidos")||o.includes("united states")||"us"===o?"us":o.includes("portugal")||"pt"===o?"pt":o.includes("espanha")||o.includes("spain")||"es"===o?"es":"br",c=new URL("https://maps.googleapis.com/maps/api/geocode/json");c.searchParams.set("address",l),c.searchParams.set("key",n),c.searchParams.set("region",m),c.searchParams.set("language","pt-BR");let p=await (0,t.fetchWithRetry)(c.toString(),{method:"GET"},{timeoutMs:1e4,maxRetries:2});if(!p.ok)return null;let d=await p.json();if("OK"!==d.status||!d.results?.[0]?.geometry?.location)return null;let u=d.results[0].geometry.location,g=u.lat,f=u.lng;return"number"!=typeof g||"number"!=typeof f?null:{latitude:g,longitude:f}}e.s(["geocodeAddress",()=>a])},10906,e=>{e.v(e=>Promise.resolve().then(()=>e(78787)))},99913,e=>{e.v(t=>Promise.all(["server/chunks/backend_src_lib_ai_encrypt_ts_ff8430df._.js"].map(t=>e.l(t))).then(()=>t(85981)))},82269,e=>{e.v(e=>Promise.resolve().then(()=>e(84680)))},31443,e=>{e.v(e=>Promise.resolve().then(()=>e(75225)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__802bd9ad._.js.map