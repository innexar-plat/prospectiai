module.exports=[84680,e=>{"use strict";var t=e.i(78787);function a(a){let{workspaceId:s,userId:r,type:o,quantity:n=1,metadata:p}=a;t.prisma.usageEvent.create({data:{workspaceId:s,userId:r??void 0,type:o,quantity:n,metadata:p||void 0}}).catch(t=>{e.A(31443).then(({logger:e})=>e.warn("Usage event record failed",{workspaceId:s,type:o,error:t instanceof Error?t.message:"Unknown"}))})}async function s(e){if(0===e.length)return new Map;let a={googlePlacesSearch:0,googlePlacesDetails:0,serperRequests:0,aiInputTokens:0,aiOutputTokens:0},s=new Map(e.map(e=>[e,{...a}]));for(let a of(await t.prisma.usageEvent.groupBy({by:["workspaceId","type"],where:{workspaceId:{in:e},type:{not:"AI_TOKENS"}},_sum:{quantity:!0}}))){let e=s.get(a.workspaceId),t=a._sum.quantity??0;"GOOGLE_PLACES_SEARCH"===a.type?e.googlePlacesSearch=t:"GOOGLE_PLACES_DETAILS"===a.type?e.googlePlacesDetails=t:"SERPER_REQUEST"===a.type&&(e.serperRequests=t)}for(let a of(await t.prisma.usageEvent.findMany({where:{workspaceId:{in:e},type:"AI_TOKENS"},select:{workspaceId:!0,metadata:!0}}))){let e=s.get(a.workspaceId),t=a.metadata;t&&(e.aiInputTokens+=Number(t.inputTokens)||0,e.aiOutputTokens+=Number(t.outputTokens)||0)}return s}e.s(["getWorkspaceUsage",()=>s,"recordUsageEvent",()=>a])}];

//# sourceMappingURL=backend_src_lib_usage_ts_1154b4f3._.js.map