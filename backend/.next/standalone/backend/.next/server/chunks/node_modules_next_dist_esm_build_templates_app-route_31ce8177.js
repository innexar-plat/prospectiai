module.exports=[86929,e=>{"use strict";var t=e.i(47909),r=e.i(74017),a=e.i(96250),o=e.i(59756),n=e.i(61916),i=e.i(74677),s=e.i(69741),l=e.i(16795),d=e.i(87718),u=e.i(95169),c=e.i(47587),p=e.i(66012),m=e.i(70101),g=e.i(26937),f=e.i(10372),y=e.i(93695);e.i(52474);var v=e.i(220),h=e.i(64397),w=e.i(78787),R=e.i(8625),k=e.i(14180),x=e.i(45881),A=e.i(48419);e.i(21564);var N=e.i(71998),E=e.i(87040),S=e.i(10266),U=e.i(43757),b=e.i(84680),C=e.i(75225);async function I(e,t,r,a,o){if(!(t?.trim()||a?.trim()))return null;try{let n=await (0,S.geocodeAddress)(t?.trim()||a?.trim()||"",r??null,"Brasil");if(!n)return null;let i=`${e} ${t?.trim()||""}`.trim(),{places:s}=await (0,U.textSearch)({textQuery:i,pageSize:5,languageCode:"pt-BR",regionCode:"BR",locationBias:{center:{latitude:n.latitude,longitude:n.longitude},radius:1e4}});(0,b.recordUsageEvent)({workspaceId:o,type:"GOOGLE_PLACES_SEARCH",quantity:1});let l=s[0];if(!l?.id)return null;let d=await (0,U.getPlaceDetails)(l.id);(0,b.recordUsageEvent)({workspaceId:o,type:"GOOGLE_PLACES_DETAILS",quantity:1});let u=(d.reviews??[]).slice(0,5).map(e=>(e.text?.text??"").slice(0,300)).filter(Boolean);return{rating:d.rating,userRatingCount:d.userRatingCount,reviewsSnippets:u}}catch(e){return C.logger.warn("Google Places context failed",{error:e instanceof Error?e.message:"Unknown"}),null}}async function P(e,t){let r,a,o=await w.prisma.user.findFirst({where:{id:t},include:{workspaces:{include:{workspace:!0},take:1}}});o?.workspaces?.length&&(r=o.workspaces[0].workspace.id);let n=function(e){let t=e.companyName.trim(),r=[`${t} Reclame Aqui`,`${t} avalia\xe7\xf5es Google`,`${t} reclama\xe7\xf5es`];t&&(r.push(`${t} Instagram`),r.push(`${t} Facebook`),r.push(`${t} LinkedIn`));let a=[];e.instagramUrl?.trim()&&a.push(e.instagramUrl.trim()),e.facebookUrl?.trim()&&a.push(e.facebookUrl.trim()),e.linkedInUrl?.trim()&&a.push(e.linkedInUrl.trim());for(let e=0;e<Math.min(a.length,3);e++){let t=r.length-3+e;t>=3&&(r[t]=a[e])}return r.slice(0,6)}(e),i=await (0,E.getWebContextForRole)("company_analysis",n,{workspaceId:r??void 0,userId:t}),s=e.city?.trim(),l=e.state?.trim(),d=r&&(s||e.address)?await I(e.companyName,s,l,e.address,r):null,u=[`- Nome: ${e.companyName}`,e.productService?`- Produto/servi\xe7o: ${e.productService}`:"",e.targetAudience?`- P\xfablico-alvo: ${e.targetAudience}`:"",e.mainBenefit?`- Benef\xedcio principal: ${e.mainBenefit}`:"",e.address?`- Endere\xe7o: ${e.address}`:"",e.websiteUrl?`- Site: ${e.websiteUrl}`:"","Links oficiais das redes (perfil da empresa):",e.linkedInUrl?`  - LinkedIn: ${e.linkedInUrl}`:"  - LinkedIn: não informado",e.instagramUrl?`  - Instagram: ${e.instagramUrl}`:"  - Instagram: não informado",e.facebookUrl?`  - Facebook: ${e.facebookUrl}`:"  - Facebook: não informado"].filter(Boolean).join("\n"),c=function(e){if(!e)return"";let t=["## Avaliações Google (dados reais do Google Places)",null!=e.rating?`- Nota: ${e.rating}`:"",null!=e.userRatingCount?`- N\xfamero de avalia\xe7\xf5es: ${e.userRatingCount}`:""].filter(Boolean);return e.reviewsSnippets.length>0&&(t.push("Trechos de avaliações:"),e.reviewsSnippets.forEach((e,r)=>t.push(`${r+1}. ${e}`))),t.join("\n")}(d),p=!e.productService?.trim()&&!e.targetAudience?.trim()&&!e.mainBenefit?.trim(),m=`Voc\xea \xe9 um consultor de neg\xf3cios especializado em diagn\xf3stico de empresas no Brasil.
Analise a empresa com base APENAS nos dados fornecidos abaixo. Cite as fontes quando fizer afirma\xe7\xf5es.
${p?"\nO tipo de negócio não foi declarado; infira a partir das fontes (web e avaliações Google).\n":""}
## Perfil da empresa (dados declarados)
${u}

${i}

${c?`
${c}
`:""}

Responda EXCLUSIVAMENTE em JSON v\xe1lido, sem markdown, sem backticks:
{
  "summary": "<resumo executivo em 2-4 frases>",
  "strengths": ["<ponto forte 1>", "<ponto forte 2>", "<ponto forte 3>"],
  "weaknesses": ["<ponto fraco 1>", "<ponto fraco 2>"],
  "opportunities": ["<oportunidade 1>", "<oportunidade 2>", "<oportunidade 3>"],
  "reclameAquiSummary": "<resumo do que foi encontrado no Reclame Aqui ou 'N\xe3o encontrado'>",
  "googlePresenceScore": <n\xfamero 0-10, presen\xe7a/avalia\xe7\xf5es Google>,
  "googleRating": <n\xfamero ou null se n\xe3o houver>,
  "googleReviewCount": <n\xfamero ou null>,
  "googleReviewsSnippets": ["<trecho 1>"] ou [],
  "socialNetworks": {
    "presence": "<resumo da presen\xe7a em redes: links declarados + o que foi encontrado na web>",
    "perNetwork": [
      { "network": "Instagram", "link": "<se declarado>", "found": "<o que a busca encontrou>", "suggestions": "<sugest\xe3o>" },
      { "network": "Facebook", "link": "<se declarado>", "found": "<o que a busca encontrou>", "suggestions": "<sugest\xe3o>" },
      { "network": "LinkedIn", "link": "<se declarado>", "found": "<o que a busca encontrou>", "suggestions": "<sugest\xe3o>" }
    ],
    "consistency": "<breve an\xe1lise de consist\xeancia entre redes>",
    "recommendations": ["<recomenda\xe7\xe3o 1 para redes>", "<recomenda\xe7\xe3o 2>"]
  },
  "suggestedNiche": "<nicho sugerido com base nos dados>",
  "suggestedBusinessModel": "<modelo de neg\xf3cio sugerido>",
  "recommendations": ["<recomenda\xe7\xe3o geral 1>", "<recomenda\xe7\xe3o 2>", "<recomenda\xe7\xe3o 3>"]
}

REGRAS: Baseie-se APENAS nos dados fornecidos. Se n\xe3o houver dados para um campo, use null ou string vazia ou "N\xe3o encontrado" conforme o caso.`,{config:g}=await (0,N.resolveAiForRole)("company_analysis"),f=await (0,N.generateCompletionForRole)("company_analysis",{prompt:m,jsonMode:!0,maxTokens:4096});r&&f.usage&&(0,b.recordUsageEvent)({workspaceId:r,userId:t,type:"AI_TOKENS",quantity:1,metadata:{provider:g.provider,model:g.model,inputTokens:f.usage.inputTokens,outputTokens:f.usage.outputTokens}});try{let e,t=f.text.replace(/```json\s*/gi,"").replace(/```\s*/gi,"").trim(),r=JSON.parse(t);a={summary:"string"==typeof r.summary?r.summary:"Análise gerada.",strengths:Array.isArray(r.strengths)?r.strengths:[],weaknesses:Array.isArray(r.weaknesses)?r.weaknesses:[],opportunities:Array.isArray(r.opportunities)?r.opportunities:[],reclameAquiSummary:"string"==typeof r.reclameAquiSummary?r.reclameAquiSummary:void 0,googlePresenceScore:"number"==typeof r.googlePresenceScore?r.googlePresenceScore:void 0,googleRating:"number"==typeof r.googleRating?r.googleRating:void 0,googleReviewCount:"number"==typeof r.googleReviewCount?r.googleReviewCount:void 0,googleReviewsSnippets:Array.isArray(r.googleReviewsSnippets)?r.googleReviewsSnippets:void 0,socialNetworks:(e=r.socialNetworks)&&"object"==typeof e&&!Array.isArray(e)?{presence:"string"==typeof e.presence?e.presence:"",perNetwork:Array.isArray(e.perNetwork)?e.perNetwork:void 0,consistency:"string"==typeof e.consistency?e.consistency:void 0,recommendations:Array.isArray(e.recommendations)?e.recommendations:void 0}:{presence:""},suggestedNiche:"string"==typeof r.suggestedNiche?r.suggestedNiche:void 0,suggestedBusinessModel:"string"==typeof r.suggestedBusinessModel?r.suggestedBusinessModel:void 0,recommendations:Array.isArray(r.recommendations)?r.recommendations:[]}}catch{a={summary:"Não foi possível gerar a análise completa. Tente novamente.",strengths:[],weaknesses:[],opportunities:[],socialNetworks:{presence:""},recommendations:["Preencha o perfil da empresa e execute novamente."]}}return r&&w.prisma.intelligenceReport.create({data:{workspaceId:r,userId:t,module:"MY_COMPANY",inputQuery:e.companyName,inputCity:s||null,inputState:l||null,resultsData:JSON.parse(JSON.stringify(a))}}).catch(e=>C.logger.error("Failed to persist company analysis report",{error:e instanceof Error?e.message:"Unknown"})),a}let q={companyName:!0,productService:!0,targetAudience:!0,mainBenefit:!0,address:!0,linkedInUrl:!0,instagramUrl:!0,facebookUrl:!0,websiteUrl:!0};async function T(t){let r=(0,k.getOrCreateRequestId)(t);try{let e=t.headers.get("x-forwarded-for")||"127.0.0.1",{success:a}=await (0,R.rateLimit)(`company-analysis:${e}`,10,60);if(!a)return(0,k.jsonWithRequestId)({error:"Too many requests. Try again later."},{status:429,requestId:r});let o=await (0,h.auth)();if(!o?.user?.id)return(0,k.jsonWithRequestId)({error:"Unauthorized"},{status:401,requestId:r});let n=await w.prisma.workspaceMember.findFirst({where:{userId:o.user.id},include:{workspace:{select:{...q,plan:!0}}}});if(!n?.workspace)return(0,k.jsonWithRequestId)({error:"Workspace not found"},{status:404,requestId:r});let i=n.workspace.plan;if(!(0,x.planHasModule)(i,"ANALISE_MINHA_EMPRESA"))return(0,k.jsonWithRequestId)({error:"Análise da minha empresa está disponível nos planos Business e Enterprise. Faça upgrade para acessar."},{status:403,requestId:r});let s=await t.json().catch(()=>({})),l=A.companyAnalysisSchema.safeParse(s),d=l.success?l.data:{useProfile:!0,companyName:void 0,city:void 0,state:void 0,productService:void 0,targetAudience:void 0,mainBenefit:void 0,address:void 0,websiteUrl:void 0,linkedInUrl:void 0,instagramUrl:void 0,facebookUrl:void 0},u=n.workspace,c=!1!==d.useProfile;if(c){if(!(d.companyName??u.companyName??"").trim())return(0,k.jsonWithRequestId)({error:"Preencha o nome da empresa no Perfil da empresa (Configurações > Empresa) ou envie companyName no corpo da requisição."},{status:400,requestId:r})}else if(!(d.companyName??"").trim())return(0,k.jsonWithRequestId)({error:'No modo "Pesquisar", informe o nome da empresa (companyName) no corpo da requisição.'},{status:400,requestId:r});let p=c?{companyName:(d.companyName??u.companyName??"").trim(),productService:u.productService??void 0,targetAudience:u.targetAudience??void 0,mainBenefit:u.mainBenefit??void 0,address:u.address??void 0,websiteUrl:u.websiteUrl??void 0,linkedInUrl:u.linkedInUrl??void 0,instagramUrl:u.instagramUrl??void 0,facebookUrl:u.facebookUrl??void 0,city:d.city,state:d.state}:{companyName:(d.companyName??"").trim(),productService:d.productService,targetAudience:d.targetAudience,mainBenefit:d.mainBenefit,address:d.address,websiteUrl:d.websiteUrl,linkedInUrl:d.linkedInUrl,instagramUrl:d.instagramUrl,facebookUrl:d.facebookUrl,city:d.city,state:d.state},m=await P(p,o.user.id);return(0,k.jsonWithRequestId)(m,{requestId:r})}catch(a){let{logger:t}=await e.A(31443);return t.error("Company analysis error",{error:a instanceof Error?a.message:"Unknown"},r),(0,k.jsonWithRequestId)({error:"Internal server error"},{status:500,requestId:r})}}e.s(["POST",()=>T],62281);var $=e.i(62281);let O=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/company-analysis/route",pathname:"/api/company-analysis",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/backend/src/app/api/company-analysis/route.ts",nextConfigOutput:"standalone",userland:$}),{workAsyncStorage:_,workUnitAsyncStorage:B,serverHooks:M}=O;function j(){return(0,a.patchFetch)({workAsyncStorage:_,workUnitAsyncStorage:B})}async function H(e,t,a){O.isDev&&(0,o.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let h="/api/company-analysis/route";h=h.replace(/\/index$/,"")||"/";let w=await O.prepare(e,t,{srcPage:h,multiZoneDraftMode:!1});if(!w)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:R,params:k,nextConfig:x,parsedUrl:A,isDraftMode:N,prerenderManifest:E,routerServerContext:S,isOnDemandRevalidate:U,revalidateOnlyGenerated:b,resolvedPathname:C,clientReferenceManifest:I,serverActionsManifest:P}=w,q=(0,s.normalizeAppPath)(h),T=!!(E.dynamicRoutes[q]||E.routes[C]),$=async()=>((null==S?void 0:S.render404)?await S.render404(e,t,A,!1):t.end("This page could not be found"),null);if(T&&!N){let e=!!E.routes[C],t=E.dynamicRoutes[q];if(t&&!1===t.fallback&&!e){if(x.experimental.adapterPath)return await $();throw new y.NoFallbackError}}let _=null;!T||O.isDev||N||(_="/index"===(_=C)?"/":_);let B=!0===O.isDev||!T,M=T&&!B;P&&I&&(0,i.setManifestsSingleton)({page:h,clientReferenceManifest:I,serverActionsManifest:P});let j=e.method||"GET",H=(0,n.getTracer)(),F=H.getActiveScopeSpan(),L={params:k,prerenderManifest:E,renderOpts:{experimental:{authInterrupts:!!x.experimental.authInterrupts},cacheComponents:!!x.cacheComponents,supportsDynamicResponse:B,incrementalCache:(0,o.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:x.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a,o)=>O.onRequestError(e,t,a,o,S)},sharedContext:{buildId:R}},D=new l.NodeNextRequest(e),G=new l.NodeNextResponse(t),W=d.NextRequestAdapter.fromNodeNextRequest(D,(0,d.signalFromNodeResponse)(t));try{let i=async e=>O.handle(W,L).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=H.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${j} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${j} ${h}`)}),s=!!(0,o.getRequestMeta)(e,"minimalMode"),l=async o=>{var n,l;let d=async({previousCacheEntry:r})=>{try{if(!s&&U&&b&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await i(o);e.fetchMetrics=L.renderOpts.fetchMetrics;let l=L.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let d=L.renderOpts.collectedTags;if(!T)return await (0,p.sendResponse)(D,G,n,L.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(n.headers);d&&(t[f.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==L.renderOpts.collectedRevalidate&&!(L.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&L.renderOpts.collectedRevalidate,a=void 0===L.renderOpts.collectedExpire||L.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:L.renderOpts.collectedExpire;return{value:{kind:v.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await O.onRequestError(e,t,{routerKind:"App Router",routePath:h,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:M,isOnDemandRevalidate:U})},!1,S),t}},u=await O.handleResponse({req:e,nextConfig:x,cacheKey:_,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:E,isRoutePPREnabled:!1,isOnDemandRevalidate:U,revalidateOnlyGenerated:b,responseGenerator:d,waitUntil:a.waitUntil,isMinimalMode:s});if(!T)return null;if((null==u||null==(n=u.value)?void 0:n.kind)!==v.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(l=u.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",U?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),N&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let y=(0,m.fromNodeOutgoingHttpHeaders)(u.value.headers);return s&&T||y.delete(f.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||y.get("Cache-Control")||y.set("Cache-Control",(0,g.getCacheControlHeader)(u.cacheControl)),await (0,p.sendResponse)(D,G,new Response(u.value.body,{headers:y,status:u.value.status||200})),null};F?await l(F):await H.withPropagatedContext(e.headers,()=>H.trace(u.BaseServerSpan.handleRequest,{spanName:`${j} ${h}`,kind:n.SpanKind.SERVER,attributes:{"http.method":j,"http.target":e.url}},l))}catch(t){if(t instanceof y.NoFallbackError||await O.onRequestError(e,t,{routerKind:"App Router",routePath:q,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:M,isOnDemandRevalidate:U})},!1,S),T)throw t;return await (0,p.sendResponse)(D,G,new Response(null,{status:500})),null}}e.s(["handler",()=>H,"patchFetch",()=>j,"routeModule",()=>O,"serverHooks",()=>M,"workAsyncStorage",()=>_,"workUnitAsyncStorage",()=>B],86929)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_31ce8177.js.map