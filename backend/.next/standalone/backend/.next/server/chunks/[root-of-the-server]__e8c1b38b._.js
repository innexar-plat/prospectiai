module.exports=[75225,e=>{"use strict";let t={info:0,warn:1,error:2},a="error"===process.env.LOG_LEVEL?"error":"info";function i(e,i,r,n){if(!(t[e]>=t[a]))return;let l=JSON.stringify({level:e,message:i,timestamp:new Date().toISOString(),...n&&{requestId:n},...r});"error"===e?process.stderr.write(l+"\n"):process.stdout.write(l+"\n")}function r(e){let t=e.headers.get("x-request-id");if(t&&"string"==typeof t)return t}e.s(["getRequestId",()=>r,"logger",0,{info(e,t,a){i("info",e,t,a)},warn(e,t,a){i("warn",e,t,a)},error(e,t,a){i("error",e,t,a)}}])},14747,(e,t,a)=>{t.exports=e.x("path",()=>require("path"))},88947,(e,t,a)=>{t.exports=e.x("stream",()=>require("stream"))},27699,(e,t,a)=>{t.exports=e.x("events",()=>require("events"))},24361,(e,t,a)=>{t.exports=e.x("util",()=>require("util"))},92509,(e,t,a)=>{t.exports=e.x("url",()=>require("url"))},22734,(e,t,a)=>{t.exports=e.x("fs",()=>require("fs"))},4446,(e,t,a)=>{t.exports=e.x("net",()=>require("net"))},79594,(e,t,a)=>{t.exports=e.x("dns",()=>require("dns"))},46786,(e,t,a)=>{t.exports=e.x("os",()=>require("os"))},55004,(e,t,a)=>{t.exports=e.x("tls",()=>require("tls"))},21517,(e,t,a)=>{t.exports=e.x("http",()=>require("http"))},24836,(e,t,a)=>{t.exports=e.x("https",()=>require("https"))},33405,(e,t,a)=>{t.exports=e.x("child_process",()=>require("child_process"))},6461,(e,t,a)=>{t.exports=e.x("zlib",()=>require("zlib"))},37405,e=>{"use strict";var t=e.i(54799);let a="aes-256-gcm";function i(){let e=process.env.AI_CONFIG_ENCRYPTION_KEY||process.env.AUTH_SECRET;if(!e||e.length<16)throw Error("AI_CONFIG_ENCRYPTION_KEY or AUTH_SECRET (min 16 chars) required for email config encryption");return(0,t.scryptSync)(e,"email-config-salt",32)}function r(e){let r=i(),n=(0,t.randomBytes)(16),l=(0,t.createCipheriv)(a,r,n),s=Buffer.concat([l.update(e,"utf8"),l.final()]),o=l.getAuthTag();return Buffer.concat([n,o,s]).toString("hex")}function n(e){let r=i(),n=Buffer.from(e,"hex");if(n.length<32)throw Error("Invalid encrypted value");let l=n.subarray(0,16),s=n.subarray(16,32),o=n.subarray(32),p=(0,t.createDecipheriv)(a,r,l);return p.setAuthTag(s),p.update(o).toString("utf8")+p.final("utf8")}e.s(["decryptEmailSecret",()=>n,"encryptEmailSecret",()=>r])},93594,e=>{"use strict";var t=e.i(78787),a=e.i(44117),i=e.i(99925);let r=[{key:"lead_analysis_ready",name:"AnÃ¡lise de lead pronta"},{key:"team_invite",name:"Convite para workspace"},{key:"admin_broadcast",name:"Broadcast admin"}];async function n(e){let a=await t.prisma.notificationChannelConfig.findUnique({where:{key:e},select:{appEnabled:!0,emailEnabled:!0}});return a?{appEnabled:a.appEnabled,emailEnabled:a.emailEnabled}:{appEnabled:!0,emailEnabled:!0}}async function l(){let e=new Map((await t.prisma.notificationChannelConfig.findMany({select:{key:!0,appEnabled:!0,emailEnabled:!0}})).map(e=>[e.key,{appEnabled:e.appEnabled,emailEnabled:e.emailEnabled}]));return r.map(t=>{let a=e.get(t.key)??{appEnabled:!0,emailEnabled:!0};return{key:t.key,name:t.name,appEnabled:a.appEnabled,emailEnabled:a.emailEnabled}})}async function s(e){let{userId:r,workspaceId:l,title:s,message:o,type:p="INFO",link:d,sendEmailIfPreferred:c=!1,emailSubject:u,channel:f}=e,m=!0,E=!0;if(f){let e=await n(f);m=e.appEnabled,E=e.emailEnabled}let y="";if(m&&(y=(await t.prisma.notification.create({data:{userId:r,workspaceId:l??void 0,title:s,message:o,type:p,link:d??void 0},select:{id:!0}})).id),c&&E){let e=await t.prisma.user.findUnique({where:{id:r},select:{email:!0,notifyByEmail:!0}});if(e?.email&&e.notifyByEmail){let t=u??s,r=(0,i.notificationTemplate)(s,o,d);(0,a.sendEmail)(e.email,t,r)}}return{id:y}}async function o(e){let r=await t.prisma.user.findMany({where:{email:{not:null},disabledAt:null},select:{id:!0,email:!0,notifyByEmail:!0}}),l=!0,s=!1;if(e.channel){let t=await n(e.channel);l=t.appEnabled,s=t.emailEnabled}if(l&&await t.prisma.notification.createMany({data:r.map(t=>({userId:t.id,title:e.title,message:e.message,type:e.type??"SYSTEM",link:e.link??void 0}))}),s){let t=e.emailSubject??e.title,n=(0,i.notificationTemplate)(e.title,e.message,e.link??void 0);for(let e of r)e.email&&e.notifyByEmail&&(0,a.sendEmail)(e.email,t,n)}return{count:r.length}}e.s(["NOTIFICATION_CHANNELS",0,r,"createNotification",()=>s,"createNotificationForAllUsers",()=>o,"getChannelsWithConfig",()=>l])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__e8c1b38b._.js.map